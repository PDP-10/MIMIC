	TITLE CPUDDM	PDP-11 CPU DESCRIPTOR
	ENTRY CPUDDM
	INTERN ITIM,SOURCE,PRMODE,MBSAVE,CPUUCB,SYSLST
	INTERN LDRUCB,REG,CPUPC
	EXTERN PERBNK,.FLAGS,SLPCHK
	INTERN TRPTBL,STM,WFLG,OLDPC,LVLARY,C,CORE,TRREG
	EXTERN CPURST,CPURD,CPUWR,CPUADR,BRSET
	EXTERN BLDUP,TRDOWN,FETCH,LOADER
	EXTERN SR

	IFNDEF PTR,<	PTR=0>
	IFNDEF PTP,<	PTP=0>
	IFNDEF CPU,<	CPU=^D8>
	MEMSIZ=CPU*^D1024
;
CPUDDM:	DDM1 CPU,CPURDB,CPUUCB
	DDM2 ^D8,^D18,^D8,^D16
	DDM3 QADR+QFIX+QBRK,^D16,MEMSIZ
	DDM4 CPURD,CPUWR,CPURST,CPUADR,BRSET,SLPCHK
;
CPUUCB:	UCB CPU,0,CPUDDM,0,0,QADR+QFIX+QBRK
;
SYSLST:	SIXBIT /PDP11/
	Z ,FETCH
	Z ,CPUPC
	XWD LOADER,LDRUCB
	Z ,BLDUP
	Z ,TRDOWN
	DDM3 QADR+QATBL+QRD,^D36,0
	Z ,STM
;
LDRUCB:	UCB LDR,0,SYSLST,0,0,QADR+QATBL+QRD
;
	CORE=CPUDDM+DNFRM
;
;PDP-11 CPU DDM, PAGE 2
;
	DEFINE TT(B,V)	;TRAP TABLE MACRO
<	XWD B,V/2>

TRPTBL:	TT BUSBIT+MEMBIT+TRCBIT,4	;1= BUS ERROR
	TT BUSBIT+MEMBIT+TRCBIT,4	;2= MEM ERROR
	TT ILLBIT+TRCBIT,4	;3= ILL INSTR ERROR
	TT RESBIT+TRCBIT,10	;4= RESERVED INSTR ERROR
	TT BKBIT+TRCBIT,14	;5= BKPT INSTR
	TT IOTBIT+TRCBIT,20	;6= IOT INSTR
	TT EMTBIT+TRCBIT,30	;7= EMT INSTR
	TT TRPBIT+TRCBIT,34	;8= TRAP INSTR
	TT TRCBIT+STKBIT,14	;9= TRACE TRAP
	TT STKBIT,4	;10= STACK TRAP
	TT PWRBIT,24	;11= POWER FAIL TRAP
;
SOURCE:	Z	;SOURCE OPERAND.
PRMODE:	XWD ^D8,^D16	;PREVAILING MODE SWITCH.
PSCORE:	MEMSIZ	;CORE REGISTER.
ITIM:	Z	;INCREMENTAL TIMER
	Z	;LAST TRDN
STM:	REPEAT 13,<	Z>	;SAVED FAST REGISTERS.
WFLG:	Z	;WAIT STATE TRAP FLAG.
MBSAVE:	Z	;TEMPORARY
REG:	REPEAT 10,<	Z>	;PDP-11 FAST REGISTERS.
OLDPC:	Z	;OLD PC.
LVLARY:	Z	;LEVEL STATUS REGISTERS:  BR7
	Z	;BR6
	Z	;BR5
	Z	;BR4
;
CPURDB:	RDB R0,REG+0,16	;PDP-11 GENERAL REGISTERS.
	RDB R1,REG+1,16
	RDB R2,REG+2,16
	RDB R3,REG+3,16
	RDB R4,REG+4,16
	RDB R5,REG+5,16
	RDB R6,REG+6,16
	RDB R7,REG+7,16
	RDB PS,STM+PS,8	;PROCESSOR STATUS.
	RBLK STAT,STM+PS,4,,8,3	;PRIORITIES ACTIVE REG.
	RBLK BR7,LVLARY+0,30,P,8,29	;LEVEL STATUS REGISTERS
	RBLK BR6,LVLARY+1,30,P,8,29	;ARE STORED LEFT JUSTIFIED
	RBLK BR5,LVLARY+2,30,P,8,29	;IN LVLARY, IN DESCENDING
	RBLK BR4,LVLARY+3,30,P,8,29	;ORDER OF PRIORITY.
	RDB SR,SR,16	;CONSOLE SWITCHES.
	RBLK OTR,STM+TR,11,,2,11	;OUTSTANDING TRAPS.
	RDB OLDPC,OLDPC,16,P	;OLD PC.
	RDB SP,REG+6,16	;STACK POINTER=R6
CPUPC:	RDB PC,REG+7,16	;PC=R7
	RDB CC,STM+PS,4	;CONDITION CODE
	RBLK LEVEL,STM+PS,3,,8,30	;PROCESSOR LEVEL.
	DRDB TM,STM,36,P
	DRDB ITM,ITIM,36	;INCREMENTAL TIMER.
	DRDB CORE,PSCORE,16,P
	FLG SINGLE,.FLAGS,1	;SINGLE INST TRAP FLAG.
	FLG SI,.FLAGS,1	;SIN INST TRAP ABBREVIATION
	RDB MA,STM+MA,18,P	;MEMORY ADDRESS.
	RDB MB,STM+MB,16,P	;MEMORY BUFFER.
	FLG WSTATE,STM+PS,17	;WAIT STATE ON FLAG.
	FLG TSTATE,STM+PS,16	;TRAP STATE FLAG.
	DRDB MODE,CPUDDM+DVAL,5,P	;THIS REGISTER IS HERE SO
		;THAT GET CAN FORCE THE CPU EX/MOD MODE BACK
		;TO THE MODE OF THE SAVED FILE.
TRREG:	FLG WAIT,WFLG,0	;WAIT STATE FLAG.
	FLG BUS,TRPTBL,0	;TRAP FLAGS.
	FLG MEM,TRPTBL+1,0
	FLG ILLEG,TRPTBL+2,0
	FLG RSV,TRPTBL+3,0
	FLG BRK,TRPTBL+4,0
	FLG IOT,TRPTBL+5,0
	FLG EMT,TRPTBL+6,0
	FLG TRP,TRPTBL+7,0
	FLG TRC,TRPTBL+8,0
	FLG STK,TRPTBL+9,0
	FLG PWR,TRPTBL+10,0
	FLG PST,WFLG,1
	Z
;
C:	XLIST
	REPEAT MEMSIZ/2,<	Z>
	LIST
	RELOC CPUDDM+DSYN
	EXTERN PDP11S
	PDP11S	;DEVICE SYNTAX.
	END
