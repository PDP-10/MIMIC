GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1
PA	MAC	28-DEC-72 13:53		PRELIMINARY ASSEMBLER DEFINITIONS

					;GENERALIZED ASSEMBLER, COMMON PARAMETERS.
					;
					;
					IFNDEF ADR,<ADR==	0>;UTIL CONDITIONAL DEFAULTS
					IFNDEF FDATA,<FDATA==	0>
					IFNDEF ONLINE,<ONLINE==	0>
					IFNDEF DTALIN,<DTALIN==	0>
					IFNDEF DIGITL,<DIGITL==	0>
					IFNDEF TYMSHR,<TYMSHR== 0>
					IFNDEF TIMLTD,<TIMLTD==	0>
					IFNDEF ISC,<ISC==	0>
					;
					;GLOBAL SWITCH DEFINITIONS, LH OF AC-0.

						;NAME	VALUE	;MEANING (1=YES)
			400000			QPASS1=400000	;PASS 1?
			200000			QNOBIN=200000	;NO BINARY FILE?
			100000			QNOLST=100000	;NO LISTING FILE?
			040000			QNLSTRQ=040000	;NO /L SEEN
			020000			QNBINRQ=020000	;NO /B SEEN

			010000			QLSTOFF=010000	;LISTING OFF? (MASTER)
			004000			QBINOFF=004000	;BINARY OFF?
			002000			QANLST=002000	;LISTING OFF? (LOCAL)
			001000			QCREF=001000	;/C SEEN?
			000200			QTTY=000200	;LISTING DEVICE IS TTY?

			000100			QCCLU=000100	;USER SUPPLIED CCL FILE
			000040			QNOERR=000040	;SUPRESS ERROR MESSAGES ON TTY?
			000020			QNOSMT=000020	;SUPRESS SYMBOL TABLE?
			000010			QCCL=000010	;CCL FILE?
			000004			QCCLC=000004	;CCL FILE IN TMPCOR FORM?
			000002			QEOF=000002	;END OF FILE ON CCL FILE?

			000001			QERROR=000001	;ERROR IN LINE?

					;GLOBAL SWITCH DEFINITIONS, RIGHT HALF OF AC-0.

			400000			QNOSYM=400000	;NO SYMBOL FILE?
			200000			QNOMAC=200000	;NO MACRO FILE?
			100000			QSYMOFF=100000	;SYMBOLS OFF?
			040000			QMACOFF=040000	;MACRO EXPANSION OFF?
			020000			QNSYMRQ=020000	;NO /D SEEN?
			010000			QNMACRQ=010000	;NO /R SEEN?

			004000			QXPAND=004000	;/E SEEN?
			002000			QVERFY=002000	;/V SEEN?
			001000			QOVRID=001000	;/O SEEN?
			000400			QNQUES=000400	;/Q SEEN?
			000200			QNADV=000200	;/X SEEN?
			000100			QADVF=000100	;/A SEEN?
			000040			QSYML=000040	;/G SEEN?
			000020			QICRF=000020	;/I SEEN?
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1-1
PA	MAC	28-DEC-72 13:53		PRELIMINARY ASSEMBLER DEFINITIONS


					;BITS 33-35 ARE RESERVED FOR USER SWITCHES:
			000007			ALLUSR=000007


						OPDEF PJRST [JRST]


GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2
PA	MAC	28-DEC-72 13:53		PRELIMINARY ASSEMBLER DEFINITIONS

					;SYMBOL TABLE FLAGS, LEFT HALF OF FLAGS WORD:
					;
			400000			QINS=400000	;INSTRUCTION
			200000			QDIR=200000	;DIRECTIVE
			100000			QLIT=100000	;LITERAL
			040000			QEXT=040000	;EXTERNAL
			020000			QENT=020000	;ENTRY
			002000			QEQV=002000	;EQUIVALENCED
			000200			QUNV=000200	;UNVALUED
			000100			QLBL=000100	;LABEL
			000001			QMAC=000001	;MACRO NAME

					;STANDARD SYMBOL TABLE BLOCK PARAMETERS:

			000004			SYMLNT=4	;4 WORDS/ENTRY
			000000			SYMN=0	;WORD 0= NAME
			000001			SYMV=1	; 1= VALUE
			000002			SYMF=2	; 2= FLAGS/CLASS#
			000003			SYMC=3	; 3= CREF POINTERS


GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

						SALL
	400000'					TWOSEG
	400000'					RELOC 400000
						TITLE GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER
						SUBTTL PRELIMINARY ASSEMBLER DEFINITIONS
					;	R.M. SUPNIK, 9/8/71
					;THIS ASSEMBLER DUPLICATES THE FUNCTIONING OF THE SO-CALLED
					;BASIC ASSEMBLER FOR THE GRI-909 AND GRI-919.  IT COMES IN TWO VERSIONS:
					;VERSION 1:  NON-RELOCATING
					;VERSION 1.1:	REVISED, SIMPLIFIED OPCODE SCANNING
					;VERSION 1.2:	REVISED BINARY OPCODE SEARCH ALGORITHM
					;VERSION 1.3:	ALTERNATE SYMBOL TABLE FOR GRI-919
					;VERSION 1.4:	^ AS XOR OPERATOR AND SWITCHES FOR GRI-99
					;VERSION 2:	RELOCATING
					;VERSION 2.1:	REVISED TO SUPPRESS EMPTY DICTIONARY BLOCKS AND
					;		TO ADD " AND _ ADVANCED FEATURES
					;VERSION 2.2:	REVISED TO CATCH RELOCATION ERRORS ON SINGLE-TERM
					;		EXPRESSIONS.
					;VERSION 2.3:	REVISED TO CORRECT RELOCATION ERRORS ON * AND /
					;		TO ADD GR DEFINITIONS AND TO ALLOW IMPLICIT DECIMALS
					;THIS IS MOST DEFINITELY
					;
	400000'	126 062 056 063 000	$VRSN:	ASCIZ /V2.3/
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;
					IFNDEF GRI99,<	GRI99=0>	;SWITCH FOR -99 FEATURES
					IFNDEF GRI919,<	GRI919=0>	;SWITCH FOR -919 OPCODES
					;
					;THE ASSEMBLER IS OF THE GARDEN VARIETY TWO PASS TYPE.  IT IS RUN
					;AS A SUB-JOB UNDER THE STANDARD MIMIC ASSEMBLER SUB-EXECUTIVE.
					;FOR USAGE NOTES, SEE THE OUTSIDE WORLD.
					;
					;ACCUMULATOR DEFINITIONS:

			000000			F=0	;EXEC FLAGS
			000001			AF=1	;ASSEMBLER FLAGS
			000017			P=17	;LOCATION PUSHDOWN POINTER
			000002			COMMA=2	;COMMA COUNT FOR STATEMENT
			000002			FLGS==COMMA	;FLAG REGISTER FOR ENTRY PUNCHING
			000013			ARG=13	;ARGUMENT REGISTER
			000003			EXPVAL=3	;OUTPUT OF EXPRESSION ANALYZER
			000004			CHR=4	;OUTPUT OF "GETCHR" COMMAND
			000005			AC=5	;TEMPORARIES
			000006			AC1=6
			000007			NAME=7	;OUTPUTS OF "GETNAM" AND "GETNUM"
			000007			NUM=7
			000010			AC2=10
			000011			AC3=11
			000012			AC4=12
			000014			T=14	;TEMPORARIES
			000015			T1=15
			000016			T2=16

			000014			FFEED=014	;FORM FEED ASCII CODE
			000012			LNFEED=012	;LINE FEED ASCII CODE
			000015			CRTN=015	;CARRIAGE RETURN ASCII CODE


						ENTRY $PASS1,$PASS2
						INTERN $USRSW,$TITLE,$SUBTTL,$NAME,$VRSN
						EXTERN ALLOC,NXTSYM,INITNX,$RDCHR,$WRCHR,$WRWRD
						EXTERN CREF,DCREF
						EXTERN $WRLIN,$SQNUM,WRCRLF
						EXTERN EOASMB,INITST
						EXTERN $CRFNO,$ERCNT
						INTERN PRSYMB,WRTFLG
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 3
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909/99/919 ASSEMBLER, PART A, PAGE 1A
					;SOME INTRODUCTORY REMARKS ON RELOCATION AND LINKAGE.
					;RELOCATION INFORMATION IS CARRIED AROUND AS PART OF THE
					;SYMBOL VALUE OR LOCATION COUNTER VALUE, IN THE FOLLOWING
					;FORMAT:
					;BITS 0-17	RELOCATION FLAG (-1=NEG REL, 0=ABS, +1=POS REL)
					;BITS 20-35	VALUE
					;HENCE RELOCATION FLAGS RANGE FROM -1 TO +1, MODULO
					;18.  THE LOWEST RELOCATION FLAG DEFINES THE OFFSET FOR INDEXING:
			000001			RELBAS=1	;ABS VALUE OF LOWEST REL FLAG.
					;
					;EXTERNAL INFORMATION IS CARRIED AROUND IN THE SYMBOL
					;TABLE AND THE SPECIAL EXTERNAL LISTS.  IN THE SYMBOL
					;TABLE, ANY UNVALUED SYMBOL IS TREATED AS AN EXTERNAL.  ITS
					;INITIAL VALUE IS 177777;  THIS VALUE IS REPLACED BY LOCATIONS
					;OF CHAINED EXTERN REFERENCES.  AT THE END OF ASSEMBLY, THE
					;EXTERN SYMBOL'S VALUE IS A POINTER TO THE MOST RECENT REFERENCE.
					;
					;EXTERNAL ARITHMETIC REFERENCES ARE CHAINED ONTO SPECIAL LIST
					;MEXLST (MASTER EXTERN LIST), DEFINED BY TWO VARIABLES:
					; MEXLST POINTS TO FIRST BLOCK (0 IF NONE)
					; MEXPTR POINTS TO LAST BLOCK
					;AN EXTERNAL REFERENCE BLOCK IS VERY SIMILAR TO A SYMBOL BLOCK,
					;EXCEPT THAT ALL DISPLACEMENTS MUST BE AUGMENTED BY SYMBOL
					;LINK, WHICH ACCOUNTS FOR THE LINK WORD.
			000001			LINK=1
					;BLOCK FORMAT:
					;WORD LINK	LINK TO NEXT BLOCK (0 IF LST)
					;WORD SYMN+LINK	SYMBOL NAME
					;WORD SYMV+LINK	SYMBOL VALUE
					;WORD SYMF+LINK	FLAGS (LEFT)
					;
					;EXTERN REFERENCES ARE BUILT ON A SPECIAL LOCAL EXTERN LIST
					;DEFINED BY VARIABLES LEXLST AND LEXPTR.  AT THE END OF EXPRESSION
					;ANALYSIS, THESE REFERENCES ARE EITHER CHAINED ONTO THE MASTER LIST,
					;OR, IF THERE WAS ONLY 1, MERGED INTO THE CORE REFERENCE CHAIN.
					;IN THE LATTER CASE, THE SINGLE EXTERN BLOCK IS DEALLOCATED BY
					;RECORDING ITS LOCATION IN "LOCBLK".  THIS BLOCK WILL BE REUSED
					;BEFORE ANY NEW BLOCKS ARE ALLOCATED.  THIS IMPLIES THAT THERE
					;CAN NEVER BE MORE THAN ONE ALLOCATED BUT UNUSED BLOCK.
					;
					;A DATA WORD WHICH IS INDEXED IS MARKED BY HAVING BIT 18 SET TO 1.
					;THIS BIT IS USED ONLY BY THE PUNCH ROUTINES AND IS ELSEWHERE IGNORED.

					;FLAGS IN GRI-COMPATIBLE SYMBOL BLOCK

			100000			GRIENT=100000	;ENTRY
			040000			GRIREL=040000	;RELOCATABLE
			020000			GRIPLS=020000	;+ EXTERN REF
			010000			GRIMIN=010000	;- EXTERN REF
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 2
					;ASSEMBLER FLAGS, RIGHT HALF OF "AF"

			400000			QLOC=400000	;PRINT FLAGS:  PRINT LOC. CNTR
			200000			QVAL=200000	;PRINT "WORD1"
			100000			QINF=100000	;PRINT "WORD1" IN INSTRUCTION FORM
			040000			QTWO=040000	;PRINT "WORD2"
			020000			QLIN=020000	;PRINT INPUT LINE
			010000			QPUN=010000	;PUNCH "WORD1"

			004000			QPERR=004000	;ERROR FLAGS:  PHASE
			002000			QMERR=002000	;MULTIPLY DEFINED SYMBOL
			001000			QDERR=001000	;RADIX ERROR
			000400			QSERR=000400	;SYNTAX
			000200			QXERR=000200	;EXTENDED FEATURE
			000100			QUERR=000100	;UNDEFINED SYMBOL OR OPCODE
			000040			QTFERR=000040	;TOO FEW EXPRESSIONS
			000020			QTMERR=000020	;TOO MANY EXPRESSIONS
			000010			QEERR=000010	;EXPRESSION ERROR
			000004			QXTERR=000004	;EXTERN ERROR
			000002			QRERR=000002	;RELOCATION ERROR
			000001			QNERR=000001	;ENTRY ERROR

					;NOTE THAT A NUMBER OF FLAGS HAVE BEEN ALLOCATED DIFFERENT
					;MEANINGS IN THE RELOCATABLE VERSION OF GRIASM:
					;ERROR		BASIC	RELOCATING
					;EXPRESSION	E	W
					;ADVANCED	X	A

					;ASSEMBLER FLAGS, LEFT HALF OF "AF":

			400000			QEND=400000	;"END" STATEMENT SEEN
			100000			QFF=100000	;FORM FEED SEEN?
			040000			QINDEX=040000	;EXPRESSION IS INDEXED.
			020000			QSIMPL=020000	;EXPRESSION ANALYZER FLAGS: SIMPLE
			010000			QEMPTY=010000	;EMPTY
			004000			QRELON=004000	;RELOCATION PERMITTED
			002000			QXTNON=002000	;EXTERNS PERMITTED
			001000			QNYDAT=001000	;ANY ENTRIES IN DICTIONARY
			000400			QXTNFR=000400	;EXTERN FREE EXPRESSION


					;NOTE THAT LEFT HAND FLAGS ARE "PERMANENT", WHILE RIGHT HAND FLAGS
					;ARE CLEARED AT THE START OF EACH LINE.

			007777			ALLERR=007777	;MASKS ALL ERROR FLAGS


					;PERMANENT (PSEUDO-EXEC) FLAGS, RIGHT-HALF OF F:

			000004			QNOINF=000004	;SUPPRESS INSTRUCTION FORM IN LISTING.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 3
					;USEFUL MACROES

						DEFINE WSIX(A)
					<	MOVE ARG,A
						PUSHJ P,PRSIX>

						DEFINE CPY(A,B)
					<	MOVE T,A
						MOVEM T,B>

						DEFINE GTEXP	;GET ADDRESS-WORD EXPRESSION
					<	PUSHJ P,EVALXP
						TRO AF,QEERR>

						DEFINE GTREXP	;GET RELOCATABLE EXPRESSION, NO EXTERNS
					<	PUSHJ P,EVLREL
						TRO AF,QEERR>

						DEFINE GTAEXP(A)	;GET ABSOLUTE EXPRESSION
					<	PUSHJ P,EVLABS
						TRO AF,QEERR
					IFNB <A>,<	DPB EXPVAL,A>>

						DEFINE CHNXT(A)	;CHECK FOR SUFFICIENT COMMAS
					<	SOJL COMMA,A
						GETCHR>

		265700	402147'			BFINIT=JSP T2,INDCNT	;INITIALIZE PUNCH BUFFER
		265700	402072'			BFCNVT=JSP T2,BUFCVT	;CONVERT DATA ITEM TO 3 BYTE
									;FORMAT AND INSERT IN PUNCH BUFFER
		265700	402101'			BFINST=JSP T2,BUFINS	;INSERT DATA ITEM IN PUNCH BUFFER
		265700	402054'			RAD50C=JSP T2,RAD50S	;RADIX 50 CONVERSION


						DEFINE PRC(A)
					<	MOVEI ARG,A
						PUSHJ P,$WRCHR>

						DEFINE MCH(A)
					<	MOVE CHR,CHAR
						CAIE CHR,A>

						DEFINE MCHR(A)
					<	MOVE CHR,CHAR
						CAIN CHR,A>

		260740	401374'			ABS=PUSHJ P,ABSORB	;ABSORB SPACES
		260740	402365'			GETCHR=PUSHJ P,GTCHRS	;GET NEXT CHARACTER
		260740	401304'			GETNAM=PUSHJ P,GTNAMS	;GET SYMBOL
		260740	401327'			GETNUM=PUSHJ P,GTNUMS	;GET INTEGER
						OPDEF FAIL [JRST]	;DEFINE FAILURE ALTERNATE

GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5-1
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

						DEFINE ADVCHK(A)
					<	TRNN F,QADVF
						JRST A
						TRNE F,QNADV
						TRO AF,QXERR>
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 4
					;INITIALIZATION ROUTINES.

	400001'	402 00 0 00 000357'	$PASS1:	SETZM ,$TITLE	;AT START OF PASS1, CLEAR TITLE AND SBTTL
	400002'	402 00 0 00 000411'		SETZM ,$SUBTTL	;BUFFERS.
	400003'	260 17 0 00 000000*		PUSHJ P,INITST	;INITIALIZE THE FREE STORAGE MECHANISM.
	400004'	260 17 0 00 400035'		PUSHJ P,INITSM	;INITIALIZE THE SYMBOL TABLE.
	400005'	254 00 0 00 400007'		JRST CMPASS	;GO TO COMMON CODE.

	400006'	260 17 0 00 401733'	$PASS2:	PUSHJ P,PENTDC	;DURING PASS2, PUNCH ENTRY DICTIONARY.
	400007'	403 01 0 00 000150'	CMPASS:	SETZB AF,TGR	;CLEAR FLAGS, TEMPORARY CORE.
	400010'	200 14 0 00 402464'		MOVE T,[XWD TGR,TGR+1]
	400011'	251 14 0 00 000347'		BLT T,TGREND
	400012'	201 14 0 00 000010		MOVEI T,^D8	;INITIALIZE PREVAILING RADIX TO 8.
	400013'	202 14 0 00 000356'		MOVEM T,PRADIX
	400014'	515 14 0 00 000001		HRLZI T,1	;SET CURLOC/OLDLOC TO 1/0 TO INDICATE
	400015'	202 14 0 00 000153'		MOVEM T,CURLOC	;ORIGIN IS RELOCATABLE ZERO.
	400016'	202 14 0 00 000152'		MOVEM T,OLDLOC
	400017'	201 13 0 00 000003		MOVEI ARG,03	;INITIALIZE PUNCH BUFFER FOR DATA PUNCHING.
	400020'	260 17 0 00 402153'		PUSHJ P,INDBBF
	400021'	260 17 0 00 400512'		PUSHJ P,PROCESS	;PROCESS THE INPUT.
	400022'	627 01 0 00 400000		TLZN AF,QEND	;END STATEMENT FOUND?
	400023'	254 00 0 00 400021'		JRST .-2	;NO, GO DO ANOTHER LINE.
	400024'	603 00 0 00 400000		TLNE F,QPASS1	;ARE WE IN PASS1? YES,
	400025'	263 17 0 00 000000		POPJ P,	;EXIT.
	400026'	260 17 0 00 402113'		PUSHJ P,OTPDAT	;NO, END OF ASSEMBLY.  OUTPUT THE REMAINING
	400027'	260 17 0 00 401761'		PUSHJ P,PEXTDC	;PART OF THE DATA BUFFER, PLUS THE EXTERN
							;DICTIONARY, PLUS THE ARITHMETIC EXPRESSION
	400030'	201 13 0 00 000002		MOVEI ARG,02	;LIST, AND AN
	400031'	260 17 0 00 000000*		PUSHJ P,$WRWRD	;"02" TO MARK END OF TAPE.
	400032'	260 17 0 00 402140'		PUSHJ P,PUNLDR	;PUNCH SOME LEADER JUST TO BE SAFE.
	400033'	260 17 0 00 000000*		PUSHJ P,EOASMB	;OUTPUT SYMBOL TABLE AND CREF TABLES
	400034'	263 17 0 00 000000		POPJ P,		;EXIT.


	400035'	201 14 0 00 000350'	INITSM:	MOVEI T,LEXLST	;INITIALIZE THE MASTER AND LOCAL EXTERN
	400036'	202 14 0 00 000351'		MOVEM T,LEXPTR	;LISTS.  THE "PTR" VARIABLE POINTS
	400037'	201 14 0 00 000352'		MOVEI T,MEXLST	;AT HEAD OF LIST;  THE HEAD OF LIST POINTS
	400040'	202 14 0 00 000353'		MOVEM T,MEXPTR	;AT ZERO.
	400041'	402 00 0 00 000350'		SETZM ,LEXLST	;ALL LISTS ARE EMPTY.
	400042'	402 00 0 00 000352'		SETZM ,MEXLST
	400043'	402 00 0 00 000354'		SETZM ,LOCBLK
	400044'	201 06 0 00 000000		MOVEI AC1,0	;INITIALIZE SYMBOL TABLE... CLEAR PTR TO
	400045'	336 00 0 06 400054'	INITSL:	SKIPN ,PSYMTB+SYMN(AC1)	;SYMBOLS.  GET CURRENT ONE.
	400046'	263 17 0 00 000000		POPJ P,	;IF NAME IS ZERO, DONE, EXIT.
	400047'	201 13 0 06 400054'		MOVEI ARG,PSYMTB(AC1)	;OTHERWISE, COMPUTE ADDRESS OF
	400050'	260 17 0 00 000000*		PUSHJ P,SINSRT	;THIS ARCHETYPE AND INSERT IT.
	400051'	254 04 0 00 000000		HALT		;**KLUDGE**
	400052'	271 06 0 00 000003		ADDI AC1,SYMLNT-1	;GO TO NEXT ARCHETYPE
	400053'	254 00 0 00 400045'		JRST INITSL	;AND CHECK FOR END OF TABLE.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 5
					;PERMANENT SYMBOL TABLE.
					;
						DEFINE PS(NM,VAL,RT)
					<	SIXBIT /NM/
						VAL
						XWD QINS,^D'RT
					>

						DEFINE PO(NM,RT)
					<	SIXBIT /NM/
						0
						XWD QDIR+QUNV,RT
					>

	400054'	41 44 44 00 00 00	PSYMTB:	PS ADD,0,0
	400055'	000000	000000
	400056'	400000	000000
	400057'	41 56 44 00 00 00		PS AND,4,0
	400060'	000000	000004
	400061'	400000	000000
	400062'	41 57 00 00 00 00		PS AO,13,0
	400063'	000000	000013
	400064'	400000	000000
	400065'	41 57 66 00 00 00		PS AOV,2,0
	400066'	000000	000002
	400067'	400000	000000
	400070'	41 70 00 00 00 00		PS AX,11,0
	400071'	000000	000011
	400072'	400000	000000
	400073'	41 71 00 00 00 00		PS AY,12,0
	400074'	000000	000012
	400075'	400000	000000
	400076'	42 57 66 00 00 00		PS BOV,2,0
	400077'	000000	000002
	400100'	400000	000000
	400101'	43 54 51 46 00 00		PS CLIF,10,0
	400102'	000000	000010
	400103'	400000	000000
	400104'	43 54 54 00 00 00		PS CLL,1,0
	400105'	000000	000001
	400106'	400000	000000
	400107'	43 54 57 46 00 00		PS CLOF,2,0
	400110'	000000	000002
	400111'	400000	000000
	400112'	43 55 54 00 00 00		PS CML,3,0
	400113'	000000	000003
	400114'	400000	000000
					IFN GRI919,<
						PS ETY,4,0
					>
	400115'	45 64 72 00 00 00		PS ETZ,2,0
	400116'	000000	000002
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7-1
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

	400117'	400000	000000
	400120'	47 45 72 00 00 00		PS GEZ,5,0
	400121'	000000	000005
	400122'	400000	000000
	400123'	47 62 21 00 00 00		PS GR1,30,0
	400124'	000000	000030
	400125'	400000	000000
	400126'	47 62 22 00 00 00		PS GR2,31,0
	400127'	000000	000031
	400130'	400000	000000
	400131'	47 62 23 00 00 00		PS GR3,32,0
	400132'	000000	000032
	400133'	400000	000000
	400134'	47 62 24 00 00 00		PS GR4,33,0
	400135'	000000	000033
	400136'	400000	000000
	400137'	47 62 25 00 00 00		PS GR5,34,0
	400140'	000000	000034
	400141'	400000	000000
	400142'	47 62 26 00 00 00		PS GR6,35,0
	400143'	000000	000035
	400144'	400000	000000
					IFN GRI919,<
						PS GR7,36,0
						PS GR8,37,0
					>
	400145'	47 64 72 00 00 00		PS GTZ,7,0
	400146'	000000	000007
	400147'	400000	000000
	400150'	50 54 64 00 00 00		PS HLT,4,0
	400151'	000000	000004
	400152'	400000	000000
	400153'	50 63 60 00 00 00		PS HSP,76,0
	400154'	000000	000076
	400155'	400000	000000
	400156'	50 63 62 00 00 00		PS HSR,76,0
	400157'	000000	000076
	400160'	400000	000000
	400161'	51 43 46 00 00 00		PS ICF,1,0
	400162'	000000	000001
	400163'	400000	000000
	400164'	51 43 57 00 00 00		PS ICO,2,0
	400165'	000000	000002
	400166'	400000	000000
	400167'	51 62 44 71 00 00		PS IRDY,10,0
	400170'	000000	000010
	400171'	400000	000000
	40011 63 62 00 00 00		PS ISR,4,0
	400173'	000000	000004
	400174'	400000	000000
	400175'	54 21 00 00 00 00		PS L1,2,0
	400176'	000000	000002
	400177'	400000	000000
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7-2
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

	400200'	54 45 72 00 00 00		PS LEZ,6,0
	400201'	000000	000006
	400202'	400000	000000
	400203'	54 56 53 00 00 00		PS LNK,4,0
	400204'	000000	000004
	400205'	400000	000000
					IFN GRI919,<
						PS LTY,10,0
					>
	400206'	54 64 72 00 00 00		PS LTZ,4,0
	400207'	000000	000004
	400210'	400000	000000
	400211'	55 63 62 00 00 00		PS MSR,17,0
	400212'	000000	000017
	400213'	400000	000000
	400214'	56 45 72 00 00 00		PS NEZ,3,0
	400215'	000000	000003
	400216'	400000	000000
	400217'	56 57 64 00 00 00		PS NOT,1,0
	400220'	000000	000001
	400221'	400000	000000
	400222'	57 62 00 00 00 00		PS OR,14,0
	400223'	000000	000014
	400224'	400000	000000
	400225'	57 62 44 71 00 00		PS ORDY,2,0
	400226'	000000	000002
	400227'	400000	000000
	400230'	60 21 00 00 00 00		PS P1,1,0
	400231'	000000	000001
	400232'	400000	000000
	400233'	60 57 53 00 00 00		PS POK,10,0
	400234'	000000	000010
	400235'	400000	000000
	400236'	62 21 00 00 00 00		PS R1,3,0
	400237'	000000	000003
	400240'	400000	000000
	400241'	63 43 00 00 00 00		PS SC,7,0
	400242'	000000	000007
	400243'	400000	000000
	400244'	63 57 66 00 00 00		PS SOV,4,0
	400245'	000000	000004
	400246'	400000	000000
					IFN GRI919,<
						PS STK,21,0
					>
	400247'	63 64 54 00 00 00		PS STL,2,0
	400250'	000000	000002
	400251'	400000	000000
	400252'	63 64 62 64 00 00		PS STRT,1,0
	400253'	000000	000001
	400254'	400000	000000
	400255'	63 67 62 00 00 00		PS SWR,10,0
	400256'	000000	000010
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7-3
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

	400257'	400000	000000
					IFE GRI919+GRI99,<
	400260'	64 62 60 00 00 00		PS TRP,3,0
	400261'	000000	000003
	400262'	400000	000000
					>
					IFN GRI919+GRI99,<
						PS TRP,23,0
					>
	400263'	64 64 51 00 00 00		PS TTI,77,0
	400264'	000000	000077
	400265'	400000	000000
	400266'	64 64 57 00 00 00		PS TTO,77,0
	400267'	000000	000077
	400270'	400000	000000
	400271'	70 57 62 00 00 00		PS XOR,10,0
	400272'	000000	000010
	400273'	400000	000000
					IFN GRI919+GRI99,<
						PS XR,22,0
					>
	400274'	000 00 0 00 000000		Z
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 6
					;OPCODE TABLE:

						DEFINE PSX(NM,VAL,RT)
					<	SIXBIT /NM/
						XWD ^D'RT,VAL>

						DEFINE POX(NM,RT)
					<	SIXBIT /NM/
						XWD RT,0>


					IFE GRI919,<
	400275'	41 44 44 00 00 00	OPTBL:	PSX ADD,4013,0
	400276'	000000	004013
	400277'	41 56 44 00 00 00		PSX AND,4413,0
	400300'	000000	004413
	400301'	41 63 43 00 00 00		POX ASC,PASC
	400302'	401253'	000000
	400303'	41 64 54 00 00 00		PSX ATL,37400,0
	400304'	000000	037400
	400305'	42 64 54 00 00 00		PSX BTL,37000,0
	400306'	000000	037000
	400307'	43 54 42 00 00 00		PSX CLB,400,0
	400310'	000000	000400
	400311'	43 54 54 00 00 00		PSX CLL,4100,0
	400312'	000000	004100
	400313'	43 55 54 00 00 00		PSX CML,4300,0
	400314'	000000	004300
	400315'	44 45 43 51 55 00		POX DECIM,PDECIM
	400316'	401120'	000000
	400317'	45 52 45 43 64 00		POX EJECT,PEJECT
	400320'	401075'	000000
	400321'	45 56 44 00 00 00		POX END,PEND
	400322'	401124'	000000
	400323'	45 56 64 62 71 00		POX ENTRY,PENTRY
	400324'	401160'	000000
	400325'	45 57 64 00 00 00		POX EOT,CPOPJ
	400326'	402310'	000000
	400327'	45 70 64 62 56 00		POX EXTRN,PEXTRN
	400330'	401203'	000000
	400331'	46 57 00 00 00 00		PSX FO,4000,1
	400332'	000001	004000
	400333'	46 57 41 00 00 00		PSX FOA,4013,2
	400334'	000002	004013
	400335'	46 57 51 00 00 00		PSX FOI,4004,2
	400336'	000002	004004
	400337'	46 57 55 00 00 00		PSX FOM,4000,2
	400340'	000002	004000
	400341'	50 54 64 00 00 00		PSX HLT,4400,0
	400342'	000000	004400
	400343'	51 43 46 00 00 00		PSX ICF,4104,0
	400344'	000000	004104
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8-1
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

	400345'	51 43 57 00 00 00		PSX ICO,4204,0
	400346'	000000	004204
	400347'	52 43 00 00 00 00		PSX JC,3,4
	400350'	000004	000003
	400351'	52 43 44 00 00 00		PSX JCD,103,4
	400352'	000004	000103
	400353'	52 56 00 00 00 00		PSX JN,37203,5
	400354'	000005	037203
	400355'	52 56 44 00 00 00		PSX JND,37303,5
	400356'	000005	037303
	400357'	52 57 00 00 00 00		PSX JO,37003,5
	400360'	000005	037003
	400361'	52 57 44 00 00 00		PSX JOD,37103,5
	400362'	000005	037103
	400363'	52 65 00 00 00 00		PSX JU,403,5
	400364'	000005	000403
	400365'	52 65 44 00 00 00		PSX JUD,503,5
	400366'	000005	000503
	400367'	54 51 63 64 00 00		POX LIST,PLIST
	400370'	401072'	000000
	400371'	54 57 43 00 00 00		POX LOC,PLOC
	400372'	401127'	000000
	400373'	55 62 00 00 00 00		PSX MR,14000,11
	400374'	000013	014000
	400375'	55 62 44 00 00 00		PSX MRD,14100,11
	400376'	000013	014100
	400377'	55 62 51 00 00 00		PSX MRI,14200,11
	400400'	000013	014200
	400401'	55 62 51 44 00 00		PSX MRID,14300,11
	400402'	000013	014300
	400403'	55 63 00 00 00 00		PSX MS,14006,12
	400404'	000014	014006
	400405'	55 63 44 00 00 00		PSX MSD,14106,12
	400406'	000014	014106
	400407'	55 63 51 00 00 00		PSX MSI,14206,12
	400410'	000014	014206
	400411'	55 63 51 44 00 00		PSX MSID,14306,12
	400412'	000014	014306
	400413'	56 54 51 63 64 00		POX NLIST,PNLIST
	400414'	401067'	000000
	400415'	56 57 60 00 00 00		PSX NOP,0,0
	400416'	000000	000000
	400417'	57 43 64 41 54 00		POX OCTAL,POCTAL
	400420'	401121'	000000
	400421'	57 62 00 00 00 00		PSX OR,5413,0
	400422'	000000	005413
	400423'	60 53 42 00 00 00		POX PKB,PPKB
	400424'	401230'	000000
	400425'	62 45 54 00 00 00		POX REL,PREL
	400426'	401152'	000000
	400427'	62 55 00 00 00 00		PSX RM,6,9
	400430'	000011	000006
	400431'	62 55 44 00 00 00		PSX RMD,106,9
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8-2
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

	400432'	000011	000106
	400433'	62 55 51 00 00 00		PSX RMI,206,9
	400434'	000011	000206
	400435'	62 55 51 44 00 00		PSX RMID,306,9
	400436'	000011	000306
	400437'	62 62 00 00 00 00		PSX RR,0,6
	400440'	000006	000000
	400441'	62 62 43 00 00 00		PSX RRC,200,6
	400442'	000006	000200
	400443'	62 63 00 00 00 00		PSX RS,0,8
	400444'	000010	000000
	400445'	62 63 43 00 00 00		PSX RSC,200,8
	400446'	000010	000200
	400447'	63 42 64 64 54 00		POX SBTTL,PSBTTL
	400450'	401100'	000000
	400451'	63 46 00 00 00 00		PSX SF,2,3
	400452'	000003	000002
	400453'	63 46 41 00 00 00		PSX SFA,26002,2
	400454'	000002	026002
	400455'	63 46 55 00 00 00		PSX SFM,2,2
	400456'	000002	000002
	400457'	63 53 60 00 00 00		PSX SKP,102,0
	400460'	000000	000102
	400461'	63 64 42 00 00 00		PSX STB,600,0
	400462'	000000	000600
	400463'	63 64 54 00 00 00		PSX STL,4200,0
	400464'	000000	004200
	400465'	64 51 64 54 45 00		POX TITLE,PTITLE
	400466'	401077'	000000
	400467'	67 62 44 00 00 00		POX WRD,PWRD
	400470'	401242'	000000
	400471'	70 57 62 00 00 00		PSX XOR,5013,0
	400472'	000000	005013
	400473'	72 55 00 00 00 00		PSX ZM,6,10
	400474'	000012	000006
	400475'	72 55 44 00 00 00		PSX ZMD,106,10
	400476'	000012	000106
	400477'	72 55 51 00 00 00		PSX ZMI,206,10
	400500'	000012	000206
	400501'	72 55 51 44 00 00		PSX ZMID,306,10
	400502'	000012	000306
	400503'	72 55 63 00 00 00		PSX ZMS,17,0
	400504'	000000	000017
	400505'	72 62 00 00 00 00		PSX ZR,0,7
	400506'	000007	000000
	400507'	72 62 43 00 00 00		PSX ZRC,200,7
	400510'	000007	000200
	400511'	377777	777777		OPTEND:	377777777777

					>
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 9
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909/919 ASSEMBLER, PAGE 6A
					;ALTERNATE OPCODE TABLE FOR GRI-919
					;
					IFN GRI919,<
					OPTBL:	PSX ADD,4013,0
						PSX AND,4413,0
						POX ASC,PASC
						PSX ATL,37400,0
						POX BLK,PBLK
						PSX BR,54000,11
						PSX BS,54026,12
						PSX BTL,37000,0
						PSX CLB,400,0
						PSX CLL,4100,0
						PSX CMB,5000,0
						PSX CML,4300,0
						POX CON,PWRD
						PSX CRR,200,6
						PSX CRS,200,8
						PSX CZR,200,7
						POX DECIM,PDECIM
						PSX DWR,50300,11
						PSX DWS,50324,12
						POX EJECT,PEJECT
						POX END,PEND
						POX ENTRY,PENTRY
						POX EOT,CPOPJ
						POX EXTRN,PEXTRN
						PSX FO,4000,1
						PSX FOA,4013,2
						PSX FOI,4004,2
						PSX FOM,4000,2
						PSX HLT,4400,0
						PSX ICF,4104,0
						PSX ICO,4204,0
						PSX IWR,14300,11
						PSX IWS,14306,12
						PSX JC,3,4
						PSX JCT,103,4
						PSX JF,37203,5
						PSX JFT,37303,5
						PSX JO,37003,5
						PSX JOT,37103,5
						PSX JU,403,5
						PSX JUT,503,5
						POX LIST,PLIST
						POX LOC,PLOC
						PSX MWR,14200,11
						PSX MWS,14206,12
						PSX NBR,54100,11
						PSX NBS,54126,12
						PSX NDBR,54200,11
						PSX NDBS,54226,12
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 9-1
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

						PSX NDWR,50200,11
						PSX NDWS,50224,12
						PSX NIBR,54300,11
						PSX NIBS,54326,12
						PSX NIWR,14100,11
						PSX NIWS,14106,12
						POX NLIST,PNLIST
						PSX NOP,0,0
						PSX NRR,100,6
						PSX NRS,100,8
						PSX NWR,50100,11
						PSX NWS,50124,12
						POX OCTAL,POCTAL
						PSX OR,5413,0
						POX PKB,PPKB
						PSX RB,26,9
						PSX RDW,324,9
						POX REL,PREL
						PSX RIW,306,9
						PSX RMW,206,9
						PSX RNB,126,9
						PSX RNDB,226,9
						PSX RNDW,224,9
						PSX RNIB,326,9
						PSX RNIW,106,9
						PSX RNR,300,6
						PSX RNW,124,9
						PSX RR,0,6
						PSX RS,0,8
						PSX RW,6,9
						POX SBTTL,PSBTTL
						PSX SF,2,3
						PSX SFA,26002,2
						PSX SFI,10002,2
						PSX SFM,2,2
						PSX SKP,102,0
						PSX STB,600,0
						PSX STL,4200,0
						POX TITLE,PTITLE
						PSX WR,14000,11
						PSX WS,14006,12
						PSX XOR,5013,0
						PSX XRW,24,9
						PSX XWR,50000,11
						PSX XWS,40024,12
						PSX XZW,24,10
						PSX ZB,26,10
						PSX ZDW,324,10
						PSX ZIW,306,10
						PSX ZMS,17,0
						PSX ZMW,206,10
						PSX ZNB,126,10
						PSX ZNDB,226,10
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 9-2
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

						PSX ZNDW,224,10
						PSX ZNIB,326,10
						PSX ZNIW,106,10
						PSX ZNR,300,7
						PSX ZNW,124,10
						PSX ZR,0,7
						PSX ZW,6,10
					OPTEND:	377777777777
					>
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 10
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 7
					;PROCESS A LINE ROUTINE.

	400512'	541 01 0 00 020000	PROCESS:	HRRI AF,QLIN	;CLEAR ALL LINE LOCAL FLAGS.
	400513'	621 00 0 00 000001		TLZ F,QERROR	;CLEAR THE "ERROR LIN LINE" FLAG.

	400514'	260740	402365'		LBLRTN:	GETCHR		;"PRIME" ALL THE SCANNERS.
	400515'	260740	401374'			ABS		;ABSORB LEADING SPACES.
	400516'	260740	401304'			GETNAM		;GET A SYMBOL OF SOME VARIETY.
	400517'	322 07 0 00 400613'		JUMPE NAME,STORWD	;NOT FOUND, TRY FOR A STORAGE WORD SYMBOL.
	400520'	260740	401374'			ABS		;FOUND, ABSORB TRAILING SPACES.


	400521'	200 04 0 00 000150'		MCHR ":"	;DID THE NAME END IN :?
	400522'	306 04 0 00 000072
	400523'	254 00 0 00 400532'		JRST PLABEL	;YES, A LABEL
	400524'	306 04 0 00 000075		CAIN CHR,"="	;NO, IN =?
	400525'	254 00 0 00 400562'		JRST PEQUIV	;YES, A DIRECT ASSIGNMENT.

	400526'	260 17 0 00 400620'		PUSHJ P,EVLIN1	;GO EVALUATE AN INSTRUCTION.
	400527'	260 17 0 00 401357'	PROCLN:	PUSHJ P,DOTAIL	;GO CLEAN UP AFTERWARDS.
	400530'	260 17 0 00 402160'		PUSHJ P,OUTPUT	;OUTPUT THE RESULTS.
	400531'	263 17 0 00 000000		POPJ P,		;EXIT TO CALLER.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 11
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 8
					;ROUTINES TO HANDLE
					;  SYMBOL:
					;  SYMBOL=
					;ENTERED WITH SYMBOL NAME IN "NAME"

	400532'	660 01 0 00 400000	PLABEL:	TRO AF,QLOC	;SET FLAG TO FORCE PRINTINGOF LOCN FIELD.
	400533'	200 13 0 00 000007		MOVE ARG,NAME	;GET SYMBOL NAME AND LOOK IT UP.
	400534'	260 17 0 00 000000*		PUSHJ P,LOOKUP	;BRANCH IF NOT FOUND.
	400535'	254 00 0 00 400551'		JRST NOTFND
	400536'	200 05 0 13 000002		MOVE AC,SYMF(ARG)	;FOUND, GET FLAGS.
	400537'	623 05 0 00 000200		TLZE AC,QUNV	;UNDEFINED (CLEAR FLAG IF SO)?
	400540'	254 00 0 00 400553'		JRST NOTDFN	;YES, GO DEFINE IT.
	400541'	603 00 0 00 400000		TLNE F,QPASS1	;DEFINED.  ARE WE IN PASS 1?
	400542'	254 00 0 00 400547'		JRST MERROR	;YES, TOO BAD, MULTIPLY DEFINED.
	400543'	200 05 0 13 000001		MOVE AC,SYMV(ARG)	;PASS 2.  VALUE SAME AS PASS 1 VALUE?
	400544'	316 05 0 00 000153'		CAMN AC,CURLOC	;MUST MATCH BOTH VALUE AND MODE.
	400545'	254 00 0 00 400557'		JRST CRLBL	;OK.
	400546'	664 01 0 00 004000	PERROR:	TROA AF,QPERR	;NO MATCH, PHASE ERROR, SET FLAG AND SKIP.
	400547'	660 01 0 00 002000	MERROR:	TRO AF,QMERR	;MULTIPLY DEFINED, SET FLAG.
	400550'	254 00 0 00 400557'		JRST CRLBL	;GO CREF.

	400551'	260 17 0 00 401522'	NOTFND:	PUSHJ P,MAKUND	;NOT FOUND, CREATE SYMBOL ENTRY.
	400552'	400 05 0 00 000000		SETZ AC,	;CLEAR ALL SYMBOL FLAGS.
	400553'	661 05 0 00 000100	NOTDFN:	TLO AC,QLBL	;FOUND BUT UNDEFINED, SET LABEL FLAG.
	400554'	502 05 0 13 000002		HLLM AC,SYMF(ARG)	;STORE FLAGS IN SYMBOL TABLE ENTRY.
	400555'	200 05 0 00 000153'		MOVE AC,CURLOC	;VALUE AND MODE ARE V/M OF LOCATION COUNTER.
	400556'	202 05 0 13 000001		MOVEM AC,SYMV(ARG)
	400557'	607 00 0 00 400000	CRLBL:	TLNN F,QPASS1	;ARE WE IN PASS 2?
	400560'	260 17 0 00 000000*		PUSHJ P,DCREF	;YES, GO CREF.
	400561'	254 00 0 00 400514'		JRST LBLRTN	;GO FINISH PROCESSING STATEMENT.

	400562'	660 01 0 00 200000	PEQUIV:	TRO AF,QVAL	;EQUIVALENCE.  FORCE PRINTING OF VALUE.
	400563'	202 07 0 00 000355'		MOVEM NAME,SAVNAM	;SAVE SYMBOL NAME.
	400564'	260740	402365'			GETCHR		;ADVANCE OVER = SIGN.
	400565'	260 17 0 00 401402'		GTREXP		;GET RELOCATABLE EXPRESSION, NO EXTERNS.
	400566'	660 01 0 00 000010
	400567'	202 03 0 00 000154'		MOVEM EXPVAL,WORD1	;SAVE FOR PRINTING.
	400570'	200 07 0 00 000355'		MOVE NAME,SAVNAM	;RESTORE NAME OF ORIG. SYMBOL.
	400571'	200 13 0 00 000007		MOVE ARG,NAME	;LOOK UP THE SYMBOL TO BE DEFINED.
	400572'	260 17 0 00 400534*		PUSHJ P,LOOKUP
	400573'	254 00 0 00 400603'		JRST NOTEQV	;NOT FOUND, PUNT.
	400574'	200 05 0 13 000002		MOVE AC,SYMF(ARG)	;FOUND, GET FLAGS.
	400575'	623 05 0 00 000200		TLZE AC,QUNV	;UNDEFINED?
	400576'	254 00 0 00 400605'		JRST NOTEQD	;YES, GO DEFINE IT.
	400577'	603 05 0 00 402000		TLNE AC,QINS+QEQV	;DEFINED, CAN IT BE REDEFINED?
	400600'	254 00 0 00 400607'		JRST REDEFN	;YES, GO REDEFINE IT.
	400601'	660 01 0 00 002000	MEQVVR:	TRO AF,QMERR	;NO, MULTIPLY DEFINED ERROR.
	400602'	254 00 0 00 400527'		JRST PROCLN	;IGNORE REDEFINITION.

	400603'	260 17 0 00 401522'	NOTEQV:	PUSHJ P,MAKUND	;NON-EXISTANT, CREATE SYMBOL ENTRY.
	400604'	400 05 0 00 000000		SETZ AC,	;CLEAR ALL FLAGS.
	400605'	661 05 0 00 002000	NOTEQD:	TLO AC,QEQV	;SET EQV FLAG.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 11-1
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

	400606'	502 05 0 13 000002		HLLM AC,SYMF(ARG)	;STORE NEW FLAGS.
	400607'	202 03 0 13 000001	REDEFN:	MOVEM EXPVAL,SYMV(ARG)	;STORE NEW VALUE.
	400610'	607 00 0 00 400000		TLNN F,QPASS1	;IF IN PASS 2, CREF THIS REFERENCE.
	400611'	260 17 0 00 400560*		PUSHJ P,DCREF
	400612'	254 00 0 00 400527'		JRST PROCLN	;GO PROCESS REST OF LINE.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 12
GRA	MAC	28-DEC-72 15:57		PRELIMINARY ASSEMBLER DEFINITIONS

					;GRI-909 ASSEMBLER, PART A, PAGE 9
					;STORAGE WORD EXPRESSION

	400613'	260 17 0 00 401404'	STORWD:	PUSHJ P,EVALXP	;EVALUATE EXPRESSION.
	400614'	254 00 0 00 400527'		JRST PROCLN	;NONE FOUND, GO DO REST OF LINE.
	400615'	202 03 0 00 000154'		MOVEM EXPVAL,WORD1	;PUT OUT THE VALUE OF THE EXPRESSION
	400616'	660 01 0 00 610000		TRO AF,QVAL+QPUN+QLOC	;SET PRINT/PUNCH FLAGS
	400617'	254 00 0 00 400527'		JRST PROCLN	;GO DO REST OF LINE.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1
GRB	MAC	28-DEC-72 16:04		PRELIMINARY ASSEMBLER DEFINITIONS


						SUBTTL EVALUATE LINE SUBROUTINE
					;EVLIN1--EVALUATE LINE ONCE OPCODE HAS BEEN FOUND.  IN THE INITIAL
					;PHASE, WE ISOLATED THE OPCODE IN "NAME". WE NOW
					;PROCEED TO EVALUATE THE REST OF THE LINE.

	400620'	201 05 0 00 000200	EVLIN1:	MOVEI AC,1B^L<OPTEND-OPTBL>	;SET UP DELTA AND INCREMENT
	400621'	201 06 0 00 000100		MOVEI AC1,1B^L<OPTEND-OPTBL>/2	;FOR BINARY SEARCH.
	400622'	316 07 0 05 400273'	OSCH1:	CAMN NAME,OPTBL-2(AC)	;PROBE.  MATCH?
	400623'	254 00 0 00 400634'		JRST FOUNDO	;YES,.
	400624'	311 07 0 05 400273'		CAML NAME,OPTBL-2(AC)	;NO, UP OR DOWN?
	400625'	674 05 0 00 000006		TDOA AC,AC1	;UP, INCREMENT.
	400626'	274 05 0 00 000006	OSCH2:	SUB AC,AC1	;DOWN, DECREMENT.
	400627'	242 06 0 00 777777		LSH AC1,-1	;HALVE INCREMENT.
	400630'	322 06 0 00 400677'		JUMPE AC1,UNDFOP	;IF ZERO, NO GO.
	400631'	303 05 0 00 000214		CAILE AC,OPTEND-OPTBL	;OUT OF BOUNDS?
	400632'	254 00 0 00 400626'		JRST OSCH2	;YES, GO DOWN.
	400633'	254 00 0 00 400622'		JRST OSCH1	;NO, RE PROBE.

	400634'	201 13 0 05 400273'	FOUNDO:	MOVEI ARG,OPTBL-2(AC)	;FOUND, CALCULATE ADDRESS.
	400635'	550 14 0 13 000001		HRRZ T,SYMV(ARG)	;PICK UP VALUE AND
	400636'	202 14 0 00 000154'		MOVEM T,WORD1	;SAVE IT.
	400637'	260 17 0 00 400662'		PUSHJ P,CCOMMA	;COUNT COMMAS IN STATEMENT
	400640'	554 05 0 13 000001		HLRZ AC,SYMV(ARG)	;GET CLASS#/PROCESSOR.
	400641'	301 05 0 00 000015		CAIL AC,MAXCLS		;IS IT A CLASS#?
	400642'	254 00 0 05 000000		JRST (AC)		;NO, PROCESSOR, GO IT!
	400643'	660 01 0 00 710000		TRO AF,QVAL+QPUN+QINF+QLOC	;YES, A REAL INSTRUCTION,
	400644'	254 00 0 05 400645'		JRST CLSSTB(AC)		;SET INSTRUCTION FLAGS AND GO TO PROPER
	400645'	254 00 0 00 402310'	CLSSTB:	JRST CPOPJ	;CLASS 0= NO OPERANDS
	400646'	254 00 0 00 400721'		JRST CLASS1		;1= FO
	400647'	254 00 0 00 400737'		JRST CLASS2		;2= FOI/FOA/SFA ECT
	400650'	254 00 0 00 400732'		JRST CLASS3		;3= SF
	400651'	254 00 0 00 400743'		JRST CLASS4		;4= JC/JCD
	400652'	254 00 0 00 400755'		JRST CLASS5		;5= JU/JUD
	400653'	254 00 0 00 400762'		JRST CLASS6		;6= RR/RRC
	400654'	254 00 0 00 400767'		JRST CLASS7		;7= ZR/ZRC
	400655'	254 00 0 00 401005'		JRST CLASS8		;8= RS/RSC
	400656'	254 00 0 00 401017'		JRST CLASS9		;9= RM
	400657'	254 00 0 00 401024'		JRST CLSS10		;10= ZM
	400660'	254 00 0 00 401036'		JRST CLSS11		;11= MR
	400661'	254 00 0 00 401055'		JRST CLSS12		;12= MS
			000015			MAXCLS=.-CLSSTB


	400662'	550 02 0 00 000156'	CCOMMA:	HRRZ COMMA,BUFPTR	;COUNT COMMAS. GET CURRENT BUFFER PTR.
	400663'	275 02 0 00 000001		SUBI COMMA,1		;BACK UP 1 FOR CHAR IN "CHAR"
	400664'	200 04 0 02 000000	CLP:	MOVE CHR,(COMMA)	;GET CURRENT CHARACTER.
	400665'	306 04 0 00 000054		CAIN CHR,","	;IS IT A COMMA?
	400666'	252 02 0 00 400664'		AOBJP COMMA,CLP	;YES, INCREMENT COUNT, ADVANCE TO NXT CHAR.
	400667'	306 04 0 00 000073		CAIN CHR,";"	;IS IT SEMI COLON?
	400670'	254 00 0 00 400675'		JRST CDONE	;YES, SCAN IS DONE.
	400671'	306 04 0 00 000042		CAIN CHR,042	;IS IT DOUBLE-QUOTE?
	400672'	344 02 0 00 400674'		AOJA COMMA,ADDONE	;YES, THEN NEXT CHARACTER IS IGNORED.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1-1
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

	400673'	302 04 0 00 000015		CAIE CHR,CRTN	;NO, CARRIAGE RETURN.
	400674'	344 02 0 00 400664'	ADDONE:	AOJA COMMA,CLP	;ADVANCE TO NEXT CHR.
	400675'	554 02 0 00 000002	CDONE:	HLRZ COMMA,COMMA	;RETURN COUNT IN COMMA WHEN DONE.
	400676'	263 17 0 00 000000		POPJ P,
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;GRI-909/99/919 ASSEMBLER, PART B, PAGE 1A
					;UNDEFINED OR NON-STANDARD OPCODE.
					;
	400677'	200 13 0 00 000007	UNDFOP:	MOVE ARG,NAME	;LOOK UP SYMBOL.
	400700'	260 17 0 00 400572*		PUSHJ P,LOOKUP
	400701'	254 00 0 00 400716'		JRST NTDFOP	;NOT FOUND.
	400702'	200 05 0 13 000002		MOVE AC,SYMF(ARG)	;FOUND, IS IT DEFINED?
	400703'	603 05 0 00 000200		TLNE AC,QUNV
	400704'	254 00 0 00 400716'		JRST NTDFOP	;NO.
	400705'	607 00 0 00 400000		TLNN F,QPASS1	;IF IN PASS 2, CREF THE REFERENCE.
	400706'	260 17 0 00 000000*		PUSHJ P,CREF
	400707'	200 14 0 13 000001		CPY SYMV(ARG),WORD1	;YES, VALUE OF SYMBOL IS OPCODE.
	400710'	202 14 0 00 000154'
	400711'	660 01 0 00 750000	STOPT:	TRO AF,QVAL+QLOC+QPUN+QTWO+QINF	;TREAT AS 2 WORD INSTRUCTION
	400712'	260 17 0 00 401404'		PUSHJ P,EVALXP	;IF NO MORE EXPRESSIONS,
	400713'	624 01 0 00 140000		TRZA AF,QTWO+QINF	;TREAT AS 1 WORD INSTRUCTION.
	400714'	202 03 0 00 000155'		MOVEM EXPVAL,WORD2	;SAVE 2ND WORD, IF ANY.
	400715'	263 17 0 00 000000		POPJ P,

	400716'	402 00 0 00 000154'	NTDFOP:	CLEARM ,WORD1	;NOT DEFINED OP.  VALUE IS ZERO.
	400717'	660 01 0 00 000100		TRO AF,QUERR	;SET UNDEFINED ERROR.
	400720'	254 00 0 00 400711'		JRST STOPT	;GO DO REST.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 3
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;PAGE 2

					;GRI-909 ASSEMBLER, PART B, PAGE 2
					;OPCODE EVALUATORS.  FOR EACH CLASS, THE BASIC OPCODE IS IN WORD1
					;AND THE PROPER 1ST WORD FLAGS HAVE BEEN SET.

					;CLASS 1:	FO MOD,DST

	400721'	260 17 0 00 401401'	CLASS1:	 GTAEXP MODPTR		;EXPRESSION 1--> MODFIELD
	400722'	660 01 0 00 000010
	400723'	137 03 0 00 402455'
	400724'	361 02 0 00 401002'		CHNXT TOOFEW		;CHECK FOR TERMINATING ",".
	400725'	260740	402365'
	400726'	260 17 0 00 401401'		GTAEXP DSTPTR		;EXPRESSION 2--> DSTFLD
	400727'	660 01 0 00 000010
	400730'	137 03 0 00 402457'
	400731'	263 17 0 00 000000		POPJ P,			;EXIT

					;CLASS 2:	FOI/FOM/FOA/SFA/SFM MOD
					;CLASS 3:	SF SRC,MOD

	400732'	260 17 0 00 401401'	CLASS3:	GTAEXP SRCPTR		;EXPRESSION 1--> SRCFIELD	
	400733'	660 01 0 00 000010
	400734'	137 03 0 00 402456'
	400735'	361 02 0 00 401002'		CHNXT TOOFEW		;CHECK FOR TERMINATING COMMA
	400736'	260740	402365'
	400737'	260 17 0 00 401401'	CLASS2:	GTAEXP MODPTR		;EXPRESSION 2--> MODPTR
	400740'	660 01 0 00 000010
	400741'	137 03 0 00 402455'
	400742'	263 17 0 00 000000		POPJ P,			;EXIT

					;CLASS 4:	JC/JCD SRC,MOD,DST
					;CLASS 5:	JU/JUD DST

	400743'	260 17 0 00 401401'	CLASS4:	GTAEXP SRCPTR		;EXPR 1--> SRCFIELD
	400744'	660 01 0 00 000010
	400745'	137 03 0 00 402456'
	400746'	361 02 0 00 401000'		CHNXT TOOFW2		;CHECK FOR TERMINATING COMMA.
	400747'	260740	402365'
	400750'	260 17 0 00 401401'		GTAEXP CNDPTR		;EXPR 2--> MODFIELD
	400751'	660 01 0 00 000010
	400752'	137 03 0 00 402463'
	400753'	361 02 0 00 401000'		CHNXT TOOFW2		;CHECK FOR TERMINATING COMMA.
	400754'	260740	402365'
	400755'	660 01 0 00 040000	CLASS5:	TRO AF,QTWO	;THIS IS A TWO WORD INSTRUCTION
	400756'	260 17 0 00 401404'		GTEXP			;GET THIRD EXPRESSION.
	400757'	660 01 0 00 000010
	400760'	202 03 0 00 000155'		MOVEM EXPVAL,WORD2	;STORE AS 2ND WORD
	400761'	263 17 0 00 000000		POPJ P,			;EXIT

					;CLASS 6:	RR/RRC SRC[,MOD],DST
					;CLASS 7:	ZR/ZRC [MOD,]DST

GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 3-1
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

	400762'	260 17 0 00 401401'	CLASS6:	GTAEXP SRCPTR		;EXPR 1--> SRCFIELD
	400763'	660 01 0 00 000010
	400764'	137 03 0 00 402456'
	400765'	361 02 0 00 401002'		CHNXT TOOFEW		;MUST BE AT LEAST ONE MORE EXPRESSION.
	400766'	260740	402365'
	400767'	260 17 0 00 401401'	CLASS7:	GTAEXP			;GET EXPR 2.
	400770'	660 01 0 00 000010
	400771'	361 02 0 00 400776'		CHNXT C7A		;IS THERE A THIRD EXPR?
	400772'	260740	402365'
	400773'	137 03 0 00 402460'		DPB EXPVAL,PMDPTR	;YES, 2ND EXPR IS MODFIELD.
	400774'	260 17 0 00 401401'		GTAEXP			;GET 3RD EXPR.
	400775'	660 01 0 00 000010

	400776'	137 03 0 00 402457'	C7A:	DPB EXPVAL,DSTPTR	;STORE IN DSTFIELD.
	400777'	263 17 0 00 000000		POPJ P,			;EXIT.

	401000'	402 00 0 00 000155'	TOOFW2:	CLEARM ,WORD2		;TOO FEW EXPRESSIONS, 2 WORD MODE...
	401001'	660 01 0 00 040000	TOOFWX:	TRO AF,QTWO		;SET 2 WORD MODE AND CLEAR 2ND WORD
	401002'	664 01 0 00 000040	TOOFEW:	TROA AF,QTFERR		;SET ERROR FLAG AND SKIP.
	401003'	660 01 0 00 000004	EXTERR:	TRO AF,QXTERR	;SET EXTERN ERROR FLAG.
	401004'	263 17 0 00 000000		POPJ P,





GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;PAGE 3

					;GRI-909 ASSEMBLER, PART B, PAGE 3
					;CLASS EVALUATORS, CONTD

					;CLASS 8:	RS/RSC SRC[,MOD]

	401005'	260 17 0 00 401401'	CLASS8:	GTAEXP SRCPTR		;EXPR 1--> SRCFIELD
	401006'	660 01 0 00 000010
	401007'	137 03 0 00 402456'
	401010'	137 03 0 00 402457'		DPB EXPVAL,DSTPTR	;ALSO INTO DSTFIELD.
	401011'	361 02 0 00 402310'		CHNXT CPOPJ		;IF NO COMMA, NO MOD FIELD.
	401012'	260740	402365'
	401013'	260 17 0 00 401401'		GTAEXP PMDPTR		;OTHERWISE, EXPR 2--> MODFIELD
	401014'	660 01 0 00 000010
	401015'	137 03 0 00 402460'
	401016'	263 17 0 00 000000		POPJ P,			;EXIT.

					;CLASS 9:	RM/RMID/RMD/RMI SRC,[MOD,]ADDR
					;CLASS 10:	ZM/ZMD/ZMI/ZMID [MOD,]ADDR

	401017'	260 17 0 00 401401'	CLASS9:	GTAEXP SRCPTR		;EXPR 1--> SRCFIELD
	401020'	660 01 0 00 000010
	401021'	137 03 0 00 402456'
	401022'	361 02 0 00 401000'		CHNXT TOOFW2		;MUST BE AT LEAST A 2ND EXPR.
	401023'	260740	402365'
	401024'	660 01 0 00 040000	CLSS10:	TRO AF,QTWO	;SET TWO WORD FLAG.
	401025'	361 02 0 00 401032'		SOJL COMMA,C10A	;IF ONLY TWO EXPRESSIONS, NO MOD FIELD.
	401026'	260 17 0 00 401401'		GTAEXP PMDPTR	;EXPRESSION 2--> MODFIELD.
	401027'	660 01 0 00 000010
	401030'	137 03 0 00 402460'
	401031'	260740	402365'			GETCHR		;REPRIME THE SCANNER
	401032'	260 17 0 00 401404'	C10A:	GTEXP		;EXPRESSION 3--> ADDRESS.
	401033'	660 01 0 00 000010
	401034'	202 03 0 00 000155'		MOVEM EXPVAL,WORD2	;SAVE AS 2ND WORD.
	401035'	263 17 0 00 000000		POPJ P,

					;CLASS 11:	MR/MRD/MRI/MRID ADDR,[MOD,]DRT

	401036'	660 01 0 00 040000	CLSS11:	TRO AF,QTWO	;SET TWO WORD FLAG.
	401037'	260 17 0 00 401404'		GTEXP			;EXPR 1--> WORD 2 AS ADDRESS FIELD.
	401040'	660 01 0 00 000010
	401041'	202 03 0 00 000155'		MOVEM EXPVAL,WORD2
	401042'	361 02 0 00 401001'		CHNXT TOOFWX		;MUST BE AT LEAST TWO EXPRESSIONS.
	401043'	260740	402365'
	401044'	260 17 0 00 401401'		GTAEXP			;GET 2ND EXPRESSION. IS THERE A 3RD?
	401045'	660 01 0 00 000010
	401046'	361 02 0 00 401053'		CHNXT C11A		;IF NOT, 2ND EXPR IS DSTFIELD.
	401047'	260740	402365'
	401050'	137 03 0 00 402460'		DPB EXPVAL,PMDPTR	;IF SO, 2ND EXPR IS MODFIELD.
	401051'	260 17 0 00 401401'		GTAEXP			;GET 3RD EXPRESSION.
	401052'	660 01 0 00 000010
	401053'	137 03 0 00 402457'	C11A:	DPB EXPVAL,DSTPTR	;SAVE AS DSTFIELD.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4-1
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

	401054'	263 17 0 00 000000		POPJ P,			;EXIT.

					;CLASS 12:	MS ADDR[,MOD]

	401055'	660 01 0 00 040000	CLSS12:	TRO AF,QTWO	;SET TWO WORD FLAG.
	401056'	260 17 0 00 401404'		GTEXP			;GET FIRST EXPRESSION.
	401057'	660 01 0 00 000010
	401060'	202 03 0 00 000155'		MOVEM EXPVAL,WORD2	;SAVE AS ADDRESS, 2ND WORD.
	401061'	361 02 0 00 402310'		CHNXT CPOPJ		;IF THERE IS A NEXT EXPR,
	401062'	260740	402365'
	401063'	260 17 0 00 401401'		GTAEXP PMDPTR		;IT IS THE MODFIELD.
	401064'	660 01 0 00 000010
	401065'	137 03 0 00 402460'
	401066'	263 17 0 00 000000		POPJ P,			;EXIT.




GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;PAGE 4

					;GRI-909 ASSEMBLER, PART B, PAGE 4
					;PSEUDO-OPERATION PROCESSORS

	401067'	606 00 0 00 001000	PNLIST:	TRNN F,QOVRID		;FEATURES ENABLED. IF ENABLED, AND IF NO
	401070'	661 00 0 00 002000		TLO F,QANLST		;OVERRIDE, DISABLE LISTING.
	401071'	263 17 0 00 000000		POPJ P,			;EXIT.

	401072'	606 00 0 00 001000	PLIST:	TRNN F,QOVRID		;IS NO OVERRIDE, ENABLE LISTING.
	401073'	621 00 0 00 002000		TLZ F,QANLST
	401074'	263 17 0 00 000000		POPJ P,			;EXIT

	401075'	661 01 0 00 100000	PEJECT:	TLO AF,QFF	;SET FORM FEED FLAG ON EJECT.  NOTE THAT
	401076'	263 17 0 00 000000		POPJ P,	;FORM FEED WILL OCCUR BEFORE EJECT, AS IN REAL ASSB.

	401077'	334 05 0 00 402465'	PTITLE:	SKIPA AC,[POINT 7,$TITLE]	;TITLE PSEUDO...
	401100'	200 05 0 00 402466'	PSBTTL:	MOVE AC,[POINT 7,$SUBTTL]	;SUBTITLE PSEUDO...
	401101'	606 00 0 00 000100		ADVCHK UNDFOP		;CHECK FOR ILLEGAL OP.
	401102'	254 00 0 00 400677'
	401103'	602 00 0 00 000200
	401104'	660 01 0 00 000200
	401105'	607 00 0 00 400000		TLNN F,QPASS1		;ARE WE IN PASS1?
	401106'	254 00 0 00 401111'		JRST STL		;NO, ORDINARY PROCESSING.
	401107'	332 00 0 05 000000		SKIPE ,(AC)		;YES, IS THE SELECTED BUFFER EMPTY?
	401110'	263 17 0 00 000000		POPJ P,			;NO, LEAVE ONLY FIRST INSTANCE IN FOR THE MOMENT.
	401111'	200 04 0 00 000150'	STL:	MOVE CHR,CHAR 		;GET CURRENT CHARACTER
	401112'	306 04 0 00 000015		CAIN CHR,CRTN	;IS CHARACTER END OF LINE?
	401113'	400 04 0 00 000000		CLEAR CHR,		;YES, SET CHARACTER TO ZERO.
	401114'	136 04 0 00 000005		IDPB CHR,AC		;AND STORE IN TITLE BUFFER OR SBTTL BUFFER.
	401115'	322 04 0 00 402310'		JUMPE CHR,CPOPJ		;IF CHARACTER WAS ZERO, EXIT.
	401116'	260740	402365'			GETCHR			;GET NEXT CHARACTER AND
	401117'	254 00 0 00 401111'		JRST STL		;GO BACK.

	401120'	334 05 0 00 402467'	PDECIM:	SKIPA AC,[^D10]		;DECIM COMMAND... SET PREVAILING RADIX TO 10.
	401121'	201 05 0 00 000010	POCTAL:	MOVEI AC,^D8		;OCTAL COMMAND... SET PREVAILING RADIX TO 8.
	401122'	202 05 0 00 000356'		MOVEM AC,PRADIX
	401123'	263 17 0 00 000000		POPJ P,		;EXIT.

	401124'	661 01 0 00 400000	PEND:	TLO AF,QEND		;SET END FLAG.
	401125'	621 00 0 00 002000		TLZ F,QANLST	;RESTORE LISTING IF OFF.
	401126'	254 00 0 00 401152'		JRST PREL	;PRETEND THAT REL STATEMENT PRECEDED.


GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;GRI-909/99/919 ASSEMBLER, PART B, PAGE 4A
					;LOC, REL, ENTRY PSEUDO-OPERATIONS.
					;
					;FOR LOC, WE EVALUATE THE ATTACHED EXPRESSION AND USE IT TO
					;SET THE LOCATION COUNTER.
					;
					;FOR REL, WE SET THE LOCATION COUNTER FROM THE LAST RELOCATABLE
					;VALUE PRIOR TO A LOC <ABS EXPR> STATEMENT.
					;
					;ENTRY DEFINES THE ATTACHED SYMBOLS AT ENTRY POINTS.
					;
	401127'	660 01 0 00 400000	PLOC:	TRO AF,QLOC	;PRINT LOCATION FIELD.
	401130'	260 17 0 00 401402'		GTREXP	;GET RELOCATABLE EXPRESSION.
	401131'	660 01 0 00 000010
	401132'	202 03 0 00 000154'		MOVEM EXPVAL,WORD1	;SAVE FOR OUTPUT.
	401133'	554 05 0 00 000003		HLRZ AC,EXPVAL	;GET RELOC. CONST. AND BRANCH
	401134'	254 00 0 05 401136'		JRST LOCTBL+RELBAS(AC)
	401135'	254 00 0 00 401200'	LOCTBL:	JRST ILLOC	;-1, NEG REL, IS ILLEGAL
	401136'	254 00 0 00 401140'		JRST ABSLOC	;0, ABSOLUTE
	401137'	254 00 0 00 401144'		JRST RELLOC	;1, RELOCTABLE

	401140'	554 05 0 00 000153'	ABSLOC:	HLRZ AC,CURLOC	;ABSOLUTE, GET CURRENT MODE.
	401141'	322 05 0 00 401144'		JUMPE AC,.+3	;ALSO ABSOLUTE? THEN DO NOTHING.
	401142'	200 05 0 00 000153'		MOVE AC,CURLOC	;FORMERLY RELOCATABLE.  SAVE CURLOC
	401143'	202 05 0 00 000152'		MOVEM AC,OLDLOC	;AS OLDLOC FOR NEXT REL STATEMENT.
	401144'	202 03 0 00 000153'	RELLOC:	MOVEM EXPVAL,CURLOC	;SAVE EXPR RESULT AS LOCN CNTR.
	401145'	603 00 0 00 400000		TLNE F,QPASS1	;IF IN PASS 1, EXIT.
	401146'	263 17 0 00 000000		POPJ P,		;IF IN PASS 2,
	401147'	260 17 0 00 402113'		PUSHJ P,OTPDAT	;PUNCH THE CURRENT DATA BUFFER
	401150'	260 17 0 00 402154'		PUSHJ P,INDBNT	;INITIALIZE THE PUNCH BUFFER FOR NEXT ITEMS.
	401151'	263 17 0 00 000000		POPJ P,	;EXIT

	401152'	660 01 0 00 400000	PREL:	TRO AF,QLOC	;PRINT LOCATION FIELD.
	401153'	200 03 0 00 000152'		MOVE EXPVAL,OLDLOC	;GET LAST SAVED VALUE.
	401154'	554 05 0 00 000153'		HLRZ AC,CURLOC	;ARE WE RELOCATABLE NOW?
	401155'	322 05 0 00 401144'		JUMPE AC,RELLOC	;NO, ABSOLUTE, REL GETS EXECUTED.
	401156'	263 17 0 00 000000		POPJ P,	;OTHERWISE DO NOTHING.

	401157'	260740	402365'		ENTLP:	GETCHR	;BETWEEN SYMBOLS, ADVANCE OVER COMMA.
	401160'	260740	401304'		PENTRY:	GETNAM	;LOOK FOR A SYMBOL.
	401161'	322 07 0 00 401201'		JUMPE NAME,ENTERR	;NOT FOUND, PUNT.
	401162'	200 13 0 00 000007		MOVE ARG,NAME	;LOOK UP THE SYMBOL.
	401163'	260 17 0 00 400700*		PUSHJ P,LOOKUP
	401164'	260 17 0 00 401522'		PUSHJ P,MAKUND	;IF NOT FOUND, CREATE IT.
	401165'	205 05 0 00 020000		MOVSI AC,QENT	;WHETHER FOUND OR CREATED, SET ENTRY BIT
	401166'	437 05 0 13 000002		IORB AC,SYMF(ARG)	;IN SYMBOL BLOCK.
	401167'	603 00 0 00 400000		TLNE F,QPASS1	;ARE WE IN PASS 2?
	401170'	254 00 0 00 401174'		JRST .+4	;NO.
	401171'	260 17 0 00 400706*		PUSHJ P,CREF	;YES, CREF THIS REFERENCE
	401172'	603 05 0 00 000200		TLNE AC,QUNV	;YES, THEN UNDEFINED ENTRIES ARE VERBOTEN.
	401173'	660 01 0 00 000101		TRO AF,QNERR+QUERR
	401174'	200 04 0 00 000150'		MCHR <",">	;SYMBOL ENDS IN COMMA?
	401175'	306 04 0 00 000054
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6-1
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

	401176'	254 00 0 00 401157'		JRST ENTLP	;YES, ON TO NEXT.
	401177'	263 17 0 00 000000		POPJ P,		;NO, EXIT.

	401200'	664 01 0 00 000002	ILLOC:	TROA AF,QRERR	;BAD RELOCATION IN LOC STATEMENT.
	401201'	660 01 0 00 000001	ENTERR:	TRO AF,QNERR	;ENTRY ERROR.
	401202'	263 17 0 00 000000		POPJ P,
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;GRI-909/99/919 ASSEMBLER, PART B, PAGE 4B
					;EXTRN PROCESSING.  SYMBOLS DEFINED THROUGH THE EXTRN FEATURE
					;ARE SIMPLY UNDEFINED'S WITH A SPECIAL FLAG WHICH CAUSES THE U
					;ERROR TO BE SUPPRESSED IF AN EXTERN REFERENCE IS GENERATED.
					;
	401203'	606 00 0 00 000100	PEXTRN:	ADVCHK UNDFOP	;EXTRN IS UNDEFINED IF NO ADVANCED FEATURES.
	401204'	254 00 0 00 400677'
	401205'	602 00 0 00 000200
	401206'	660 01 0 00 000200
	401207'	260740	401304'		EXTNLP:	GETNAM		;GET A SYMBOL NAME.
	401210'	322 07 0 00 401003'		JUMPE NAME,EXTERR	;NONE FOUND, ERROR.
	401211'	200 13 0 00 000007		MOVE ARG,NAME	;LOOK THE SYMBOL UP.
	401212'	260 17 0 00 401163*		PUSHJ P,LOOKUP
	401213'	260 17 0 00 401522'		PUSHJ P,MAKUND	;IF NOT FOUND, CREATE IT.
	401214'	205 05 0 00 040000		MOVSI AC,QEXT	;SET EXTERN FLAG IN SYMBOL BLOCK.
	401215'	437 05 0 13 000002		IORB AC,SYMF(ARG)
	401216'	603 00 0 00 400000		TLNE F,QPASS1	;ARE WE IN PASS 2?
	401217'	254 00 0 00 401223'		JRST .+4	;NO.
	401220'	260 17 0 00 400611*		PUSHJ P,DCREF	;YES, CREF THIS REFERENCE.
	401221'	607 05 0 00 000200		TLNN AC,QUNV	;IS SYMBOL DEFINED?
	401222'	660 01 0 00 000004		TRO AF,QXTERR	;YES, ERROR, EXTERNS CANNOT BE DEFINED.
	401223'	200 04 0 00 000150'		MCH <",">	;DOES FIELD END IN COMMA?
	401224'	302 04 0 00 000054
	401225'	263 17 0 00 000000		POPJ P,		;NO, EXIT.
	401226'	260740	402365'			GETCHR		;YES, ONTO NEXT SYMBOL.
	401227'	254 00 0 00 401207'		JRST EXTNLP
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 10
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;PAGE  5

					;GRI-909 ASSEMBLER, PART B, PAGE 5

					;CONSTANT AND DATA GENRATION PSEUDO-OPERATIONS.


	401230'	660 01 0 00 610000	PPKB:	TRO AF,QLOC+QVAL+QPUN	;PKB... SET PRINT/PUNCH FLAGS.
	401231'	260 17 0 00 401401'		GTAEXP LHBYTE		;EXPR 1--> BITS 15-8.
	401232'	660 01 0 00 000010
	401233'	137 03 0 00 402462'
	401234'	361 02 0 00 401002'		CHNXT TOOFEW		;THERE MUST BE 2 EXPRESSIONS.
	401235'	260740	402365'
	401236'	260 17 0 00 401401'		GTAEXP RHBYTE		;EXPR 2--> BITS 7-0.
	401237'	660 01 0 00 000010
	401240'	137 03 0 00 402461'
	401241'	263 17 0 00 000000		POPJ P,			;EXIT

	401242'	260 17 0 00 401404'	PWRD:	GTEXP			;GET THE FIRST (NEXT) EXPRESSION AND SAVE ITS VALUE
	401243'	660 01 0 00 000010
	401244'	202 03 0 00 000154'		MOVEM EXPVAL,WORD1
	401245'	660 01 0 00 610000		TRO AF,QVAL+QLOC+QPUN	;SET FLAGS TO PRINT AND PUNCH.
	401246'	361 02 0 00 402310'		CHNXT CPOPJ		;LOOK FOR NEXT EXPRESSION. IF NONE, EXIT,
	401247'	260740	402365'
									;SO THAT HIGHER LEVEL ROUTINE CAN PRINT RESULT
									;OF LAST EXPRESSION FOUND.
	401250'	260 17 0 00 402160'		PUSHJ P,OUTPUT		;NOT LAST, OUTPUT CURRENT VALUE.
	401251'	620 01 0 00 020000		TRZ AF,QLIN		;DONT PRINT LINE AFTER 1ST PRINT OPERATION.

	401252'	254 00 0 00 401242'		JRST PWRD		;START OVER

	401253'	200 04 0 00 000150'	PASC:	MOVE CHR,CHAR		;ASC COMMAND... SAVE FIRST CHARACTER AS
	401254'	202 04 0 00 000151'		MOVEM CHR,TRMCR		;STRING DELIMITER.
	401255'	306 04 0 00 000015		CAIN CHR,CRTN	;IS IT END OF LINE?
	401256'	254 00 0 00 401366'		JRST BADASC		;YES, ILLEGAL COMMAND.

	401257'	260740	402365'		ASCLP:	GETCHR			;GET NEXT CHARACTER.
	401260'	316 04 0 00 000151'		CAMN CHR,TRMCR		;IS IT END OF STRING?
	401261'	254 00 0 00 401302'		JRST REPRIM		;YES, EXIT.
	401262'	306 04 0 00 000015		CAIN CHR,CRTN	;IS IT END OF LINE?
	401263'	254 00 0 00 402310'		JRST CPOPJ	;YES, TREAT AS TERMINATOR.
	401264'	435 04 0 00 000200		IORI CHR,200	;FORCE ON HIGH ORDER BIT.
	401265'	336 05 0 00 000154'		SKIPN AC,WORD1		;NO, ANYTHING GENERATED YET?
	401266'	254 00 0 00 401274'		JRST PUTLH		;NOTHING YET, STORE INTO LEFT HALF.
	401267'	606 05 0 00 000377		TRNN AC,000377		;BOTH HALVES FILLED?
	401270'	254 00 0 00 401300'		JRST PUTRH		;NO, STORE INTO RIGHT HALF.
	401271'	660 01 0 00 610000	PUTASC:	TRO AF,QPUN+QVAL+QLOC	;SET PRINT/PUNCH FLAGS
	401272'	260 17 0 00 402160'		PUSHJ P,OUTPUT		;AND DO OUTPUT TO DATE.
	401273'	620 01 0 00 020000		TRZ AF,QLIN		;AFTER 1ST LINE, KILL LINE BUFFER PRINT.
	401274'	242 04 0 00 000010	PUTLH:	LSH CHR,^D8		;STORE CHARACTER INTO OUTPUT WORD, LEFT HALF.
	401275'	202 04 0 00 000154'		MOVEM CHR,WORD1
	401276'	660 01 0 00 610000		TRO AF,QVAL+QPUN+QLOC	;SET PRINT/PUNCH FLAGS.
	401277'	254 00 0 00 401257'		JRST ASCLP		;GET NEXT CHARACTER.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 10-1
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

	401300'	436 04 0 00 000154'	PUTRH:	IORM CHR,WORD1		;STORE CHARACTER INTO OUTPUT WORD, RIGHT HALF.
	401301'	254 00 0 00 401257'		JRST ASCLP		;SET NEXT CHARACTER.
	401302'	260740	402365'		REPRIM:	GETCHR			;AT EXIT, PRIME FURTHER SCANNERS.
	401303'	263 17 0 00 000000		POPJ P,			;EXIT.




					IFN GRI919,<
					PBLK:	GTAEXP	;BLK PSEUDO-OPERATION.  GET BLOCK COUNT.
						JUMPE EXPVAL,CPOPJ	;EXIT ON COUNT OF ZERO.
						MOVEM EXPVAL,WORD2	;SAVE AS COUNTER.
						CHNXT TOOFEW	;CHECK FOR ANOTHER EXPRESSION.
					BLKLP:	GTEXP	;GET FIRST/NEXT EXPRESSION.
						MOVEM EXPVAL,WORD1	;SAVE RESULT FOR OUTPUT.
						TRO AF,QVAL+QLOC+QPUN	;FORCE OUTPUT AND LISTING.
						CHNXT FILLCT	;IS THERE ANOTHER EXPRESSION?
						PUSHJ P,OUTPUT	;YES, OUTPUT CURRENT VALUE.
						TRZ AF,QLIN	;AFTER 1ST EXPR, DONT PRINT LINE.
						SOSE ,WORD2	;DECREMENT COUNT.  ZERO?
						JRST BLKLP	;NO, GO GET NEW EXPRESSION.
						POPJ P,	;YES, EXIT.
					
					FILLCT:	SOSN ,WORD2	;NO MORE EXPRESSIONS ON LINE.  IS THIS
						POPJ P,	;THE LAST WORD?  IF SO, EXIT, HIGHER LEVEL ROUTINE
							;WILL OUTPUT IT.
						PUSHJ P,OUTPUT	;NO, OUTPUT IT HERE.
						TRZ AF,QLIN
						JRST FILLCT	;GO COUNT DOWN COUNT.
					>
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 11
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;PAGE 6

					;GRI-909 ASSEMBLER, PART B, PAGE 6
					;SYNTAX OPERATORS AND EVALUATORS.
					;SUBTTL SYNTAX OPERATORS

	401304'	400 07 0 00 000000	GTNAMS:	CLEAR NAME,		;GET A NAME ROUTINE... CLEAR NAME HOLDER.
	401305'	200 05 0 00 402470'		MOVE AC,[POINT 6,NAME]	;SET UP POINTER TO NAME HOLDER.
	401306'	200 04 0 00 000150'		MOVE CHR,CHAR		;GET CURRENT CHARACTER.

	401307'	302 04 0 00 000100	CHKIT:	CAIE CHR,"@"		;IS IT A SPECIAL LETTER, I.E.,
	401310'	306 04 0 00 000044		CAIN CHR,"$"		;@,$, OR $
	401311'	254 00 0 00 401317'		JRST STORIT		;YES.
	401312'	306 04 0 00 000045		CAIN CHR,"%"
	401313'	254 00 0 00 401317'		JRST STORIT
	401314'	301 04 0 00 000101		CAIL CHR,"A"
	401315'	303 04 0 00 000132		CAILE CHR,"Z"
	401316'	263 17 0 00 000000		POPJ P,			;NOT A LETTER, EXIT.
	401317'	275 04 0 00 000040	STORIT:	SUBI CHR,40		;CHARACTER PASSES... CONVERT TO SIXBIT
	401320'	606 07 0 00 007700		TRNN NAME,007700	;HAVE WE GOTTEN 5 CHARACTERS YET?
	401321'	136 04 0 00 000005		IDPB CHR,AC		;NO, STORE NEW CHARACTER.
	401322'	260740	402365'			GETCHR			;GET NEXT CHARACTER.
	401323'	301 04 0 00 000060		CAIL CHR,"0"		;IS IT A NUMBER?
	401324'	303 04 0 00 000071		CAILE CHR,"9"
	401325'	254 00 0 00 401307'		JRST CHKIT		;NO, CHECK FOR  A LETTER.
	401326'	254 00 0 00 401317'		JRST STORIT		;YES, GO APPEND TO NAME.

	401327'	403 07 0 00 000010	GTNUMS:	CLEARB NUM,AC2		;GET A NUMBER ROUTINE...CLEAR NUMBER HOLDER.
	401330'	200 04 0 00 000150'	NUMLP:	MOVE CHR,CHAR		;GET FIRST CHARACTER.
	401331'	301 04 0 00 000060		CAIL CHR,"0"		;IS IT A DIGIT?
	401332'	303 04 0 00 000071		CAILE CHR,"9"
	401333'	263 17 0 00 000000		POPJ P,			;NO, FAIL.
	401334'	275 04 0 00 000060	STONUM:	SUBI CHR,"0"		;YES, CONVERT FROM ASCII TO BINARY.
	401335'	311 04 0 00 000356'		CAML CHR,PRADIX		;IS THE CHARACTER LEGAL IN CURRENT RADIX?
	401336'	660 01 0 00 001000		TRO AF,QDERR		;NO, ERROR.
	401337'	220 07 0 00 000356'		IMUL NUM,PRADIX		;NUMBER= NUMBER*RADIX+ DIGIT.
	401340'	270 07 0 00 000004		ADD NUM,CHR
	401341'	221 10 0 00 000012		IMULI AC2,^D10		;AC2 HOLDS SAME NUMBER BASE 10.
	401342'	270 10 0 00 000004		ADD AC2,CHR
	401343'	260740	402365'			GETCHR			;GET NEXT CHARACTER.
	401344'	301 04 0 00 000060		CAIL CHR,"0"		;IS THIS A DIGIT?
	401345'	303 04 0 00 000071		CAILE CHR,"9"
	401346'	254 00 0 00 401350'		JRST NMEXIT		;NO, EXIT, END OF NUMBER.
	401347'	254 00 0 00 401334'		JRST STONUM		;YES, GO STORE.




					;
	401350'	302 04 0 00 000056	NMEXIT:	CAIE CHR,"."		;DOES # END IN PERIOD?
	401351'	254 00 0 00 401355'		JRST MSKNUM		;NO.
	401352'	620 01 0 00 001000		TRZ AF,QDERR		;YES, CLEAR PROBABLE RADIX ERROR.
	401353'	200 07 0 00 000010		MOVE NUM,AC2		;RETURN DECIMAL VERSION OF NUMBER.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 11-1
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

	401354'	260740	402365'			GETCHR			;REPRIME THE SCANNER.
	401355'	405 07 0 00 177777	MSKNUM:	ANDI NUM,177777		;CUT RESULT TO 16 BITS AND
	401356'	254 00 0 00 401573'		JRST CPOPJ1		;EXIT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 12
GRB	MAC	28-DEC-72 16:04		EVALUATE LINE SUBROUTINE

					;PAGE 7

					;GRI-909 ASSEMBLER, PART B, PAGE 7

	401357'	260740	401374'		DOTAIL:	ABS		;ABSORB TAIL OF STATEMENT, INCLUDING COMMENT.
	401360'	200 04 0 00 000150'		MCH <";">	;IS NEXT CHARACTER A COMMENT DELIMITER
	401361'	302 04 0 00 000073
	401362'	306 04 0 00 000015		CAIN CHR,CRTN	;OR END OF LINE?
	401363'	254 00 0 00 401367'		JRST FLSHBUF	;YES, FLUSH REST OF BUFFER.
	401364'	306 04 0 00 000054		CAIN CHR,","		;NO EOL... IS CHARACTER A COMMA?
	401365'	664 01 0 00 000020		TROA AF,QTMERR		;YES, TOO MANY EXPRESSIONS.
	401366'	660 01 0 00 000400	BADASC:	TRO AF,QSERR		;NO, A SYNTAX ERROR.
	401367'	350 05 0 00 000156'	FLSHBUF:	AOS AC,BUFPTR	;ADVANCE BUFFER POINTER
	401370'	332 00 0 05 000000		SKIPE ,(AC)	;ARE WE AT END?
	401371'	254 00 0 00 401367'		JRST FLSHBUF	;NO, CONTINUE FLUSHING.
	401372'	263 17 0 00 000000		POPJ P,		;EXIT.

	401373'	260740	402365'		ABSLP:	GETCHR			;ABSORB SPACES/TABS. TRIVIAL
	401374'	200 04 0 00 000150'	ABSORB:	MCH " "
	401375'	302 04 0 00 000040
	401376'	306 04 0 00 000011		CAIN CHR,"	"
	401377'	254 00 0 00 401373'		JRST ABSLP
	401400'	263 17 0 00 000000		POPJ P,

GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

						SUBTTL EXPRESSION ANALYZER
					;
					;THE EXPRESSION ANALYZER, ALTHOUGH SYNTACTICALLY SIMPLE, IS
					;SOMEWHAT HAIR-RAISING IN ITS IMPLEMENTATION, BECAUSE OF THREE
					;COMPLICATIONS, TO WIT: INDEXING, RELOCATION, AND EXTERNALS.
					;THE ANALYZER WORKS IN THREE MODES:
					;1. ABSOLUTE.  EXTERNS AND RELOCATION FORBIDDEN, INDEXING SIMPLY
					;  TURNS ON HIGH ORDER BIT OF RESULT.
					;2. RELOCATABLE NON-DATA.  EXTERNS ARE FORBIDDEN, INDEXING SIMPLY
					;  TURNS ON HIGH ORDER BIT OF RESULT.
					;3. GENERATING DATA.  EVERYTHING IS LEGAL.  INDEXING, IF SPECIFIED,
					; IS PASSED ON AS A FLAG (BIT 18=1) IN EXPVAL.
					;
					;IF RELOCATION IS PERMITTED, RELOCATION INFORMATION IS RETURNED
					;IN THE LEFT HALF OF EXPVAL:
					; -1	NEGATIVE REL
					; 0	ABSOLUTE
					; +1	POSITIVE (NORMAL) REL
					;
					;IF EXTERNALS ARE PERMITTED, ALL EXTERNAL REFERENCES ARE FORMED INTO
					;BLOCKS ON THE LOCAL EXTERN LIST, WHICH IS DISPOSED OF IN ONE OF TWO
					;WAYS:
					;1. IN A COMPLEX, MULTI-TERM EXPRESSION, THE EXTERNAL TERMS ARE LINKED
					; ONTO THE MASTER LIST OF EXTERNAL TERMS.
					;2. IN A SINGLE TERM (SIMPLE) EXPRESSION, THE EXTERN IS LINKED
					; THRU CORE TO PREVIOUS SIMPLE REFERENCES.  THE GENERATED BLOCK IS
					; DROPPED.

					;NOTE THE USE OF THE FOLLOWING FLAGS:
					;QINDEX		EXPRESSION IS INDEXED
					;QEMPTY		EXPRESSION IS EMPTY
					;QSIMPL		EXPRESSION IS SIMPLE (SINGLE TERM)
					;QRELON		RELOCATION IS PERMITTED
					;QXTNON		EXTERNS ARE PERMITTED
					;QTWO		TWO WORD INSTRUCTION

						DEFINE TRMS(B)	;SCH FOR TERMINATOR
					<	MOVEI ARG,B
						JSP AC4,TRMSUB>

			000011			OPR=AC3	;OUTSTANDING OPERATION CODE
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI-909/99/919 EXPRESSION ANALYZER, PAGE 2
					;FIRST, VARIOUS ENTRY POINTS FOR SETTING CONTROL FLAGS:
					;EVLABS	ASBSOLUTE
					;EVLREL	RELOCATING NON-DATA
					;EVALXP	NORMAL

	401401'	625 01 0 00 004000	EVLABS:	TLZA AF,QRELON	;ABSOLUTE: REL/EXTN VERBOTEN
	401402'	661 01 0 00 004000	EVLREL:	TLO AF,QRELON	;RELOCATING NON-DATA: REL OK, EXTN NOT
	401403'	625 01 0 00 002000		TLZA AF,QXTNON	;PERMITTED.
	401404'	661 01 0 00 006000	EVALXP:	TLO AF,QRELON+QXTNON	;NORMAL:  ANYTHING GOES.
	401405'	661 01 0 00 030400		TLO AF,QSIMPL+QEMPTY+QXTNFR	;MARK EXPRESSION AS SIMPLE/EMPTY
	401406'	260740	401374'			ABS		;ABSORB LEADING SPACES.
					IFN GRI99+GRI919,<
						TLZ AF,QINDEX	;INIT TO UNINDEXED.
						MCH "#"		;IS FIRST CHAR AN INDEX FLAG?
						JRST NOINDX	;NO
						TLO AF,QINDEX	;YES, SET INDEX FLAG SEEN BIT.
						GETCHR		;ADVANCE TO NEXT CHARACTER.
					NOINDX:>
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 3
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI:909/99/919 EXPRESSION ANALYZER, PAGE 3
					;MAIN LOOP OF ANALYZER.

	401407'	400 11 0 00 000000		SETZ OPR,	;IMPLICIT INITIAL OPERATOR IS ZERO (ADD).
	401410'	260 17 0 00 401556'		PUSHJ P,FACTOR	;TRY FOR A FACTOR.  OK IF NOT FOUND.
	401411'	255 00 0 00 000000		JFCL
	401412'	201 13 0 00 401466'	MORFAC:	TRMS ADOP	;TRY FOR +/-/!/&/^ OPERATOR.
	401413'	265 12 0 00 401513'
	401414'	254 00 0 00 401441'		JRST BLKOP	;NOT FOUND.
	401415'	260740	401374'		NXTFC1:	ABS		;FOUND, ABSORB BLANKS.
	401416'	621 01 0 00 020000	NXTFAC:	TLZ AF,QSIMPL	;IF OPERATOR SEEN, EXPRESSION IS NOT SIMPLE.
	401417'	261 17 0 00 000003		PUSH P,EXPVAL	;SAVE VALUE DEVELOPED SO FAR.
	401420'	260 17 0 00 401556'		PUSHJ P,FACTOR	;GET ANOTHER FACTOR.
	401421'	660 01 0 00 000010		TRO AF,QEERR	;IF NOT FOUND, GIVE WARNING ERROR.
	401422'	262 17 0 00 000005		POP P,AC	;POP PREVIOUS VALUE OFEXPRESSION.
	401423'	603 01 0 00 004000		TLNE AF,QRELON	;RELOCATION PERMITTED?
	401424'	301 11 0 00 000002		CAIL OPR,NRELOP	;YES, IS OPERATOR RELOCATABLE?
	401425'	254 00 0 00 401431'		JRST NORELN	;NOT PERMITTED, GO CHECK FOR ABSOLUTE.
	401426'	256 00 0 11 401503'		XCT ,OPRTBL(OPR)	;EXPVAL_AC 'OPR' EXPVAL
	401427'	620 03 0 00 600000		TRZ EXPVAL,600000	;CUT DATA RESULT TO 16 BITS.
	401430'	254 00 0 00 401412'		JRST MORFAC	;TRY FOR MORE.

	401431'	627 03 0 00 777777	NORELN:	TLZN EXPVAL,777777	;NO RELOCATION PERMITTED.  IF EITHER
	401432'	623 05 0 00 777777		TLZE AC,777777	;VALUE IS RELOCATABLE,
	401433'	660 01 0 00 000002		TRO AF,QRERR	;GIVE ERROR.
	401434'	607 01 0 00 000400		TLNN AF,QXTNFR	;FURTHER, EXPRESSION MUST CONTAIN NO EXTERNS,
	401435'	660 01 0 00 000004		TRO AF,QXTERR	;OTHERWISE ERROR
	401436'	256 00 0 11 401503'		XCT ,OPRTBL(OPR)	;DO OPERATION AND
	401437'	405 03 0 00 177777		ANDI EXPVAL,177777	;SET ABSOLUTE MODE, 16 BIT ANSWER.
	401440'	254 00 0 00 401412'		JRST MORFAC	;ONWARDS.

	401441'	201 13 0 00 401474'	BLKOP:	TRMS BLNKOP	;OPERATOR NOT ADD, LOOK FOR SPACE/TAB.
	401442'	265 12 0 00 401513'
	401443'	254 00 0 00 401455'		JRST ADVOPR	;NOT FOUND, LOOK FOR * OR /
	401444'	260740	401374'			ABS		;BLANK FOUND, ABSORB OTHER BLANKS.
	401445'	200 04 0 00 000150'		MCHR <";">	;END OF STATEMENT?
	401446'	306 04 0 00 000073
	401447'	254 00 0 00 401636'		JRST CLNUP	;YES, SPACE/TAB NOT AN OPERATOR AT ALL.
	401450'	302 04 0 00 000054		CAIE CHR,<",">
	401451'	306 04 0 00 000015		CAIN CHR,CRTN
	401452'	254 00 0 00 401636'		JRST CLNUP	;FIELD IS TERMINATED BY , ; AND CRTN.
	401453'	201 11 0 00 000002		MOVEI OPR,ORNUM	;NOT END OF FIELD, SPACE/TAB MEANS IOR.
	401454'	254 00 0 00 401416'		JRST NXTFAC	;GO LOOK FOR NEXT FACTOR.

	401455'	606 00 0 00 000100	ADVOPR:	TRNN F,QADVF	;OPERATOR NOT ADD OR BLANK, ADV FEATURES ON?
	401456'	254 00 0 00 401636'		JRST CLNUP	;NO, LOOK NO FURTHER
	401457'	201 13 0 00 401477'		TRMS ADVOP	;ENABLED, LOOK FOR * AND /
	401460'	265 12 0 00 401513'
	401461'	254 00 0 00 401636'		JRST CLNUP	;NOT FOUND, GIVE UP
	401462'	271 11 0 00 000005		ADDI OPR,NUMOP
	401463'	602 00 0 00 000200		TRNE F,QNADV	;FOUND, ARE ADV. FEATURES TO BE FLAGGED?
	401464'	435 01 0 00 000200		IORI AF,QXERR	;YES, DO SO.
	401465'	254 00 0 00 401415'		JRST NXTFC1	;GO LOOK FOR NEXT FACTOR.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI-909/919/99 EXPRESSION ANALYZER, PAGE 4
					;OPERATOR TABLES AND SEARCH ROUTINES.

	401466'	000000	000053		ADOP:	"+"	;0= ADD
	401467'	000000	000055			"-"	;1= SUBTRACT
			000002			NRELOP=.-ADOP	;ALL REL. OPERATORS ABOVE THIS POINT
	401470'	000000	000041			"!"	;2= OR
			000002			ORNUM=.-ADOP-1
	401471'	000000	000046			"&"	;3= AND
	401472'	000000	000136			"^"	;4= XOR
			000005		NUMOP=.-ADOP
	401473'	000 00 0 00 000000		Z

	401474'	000000	000040		BLNKOP:	" "	;BLANK OPERATORS ARE SPACE/TAB
	401475'	000000	000011			"	"
	401476'	000 00 0 00 000000		Z

	401477'	000000	000052		ADVOP:	"*"	;ADVANCED OPERATORS ARE * AND /
	401500'	000000	000057			"/"
	401501'	000000	000137			"_"	;ALSO _ FOR SHIFT
	401502'	000 00 0 00 000000		Z

	401503'	270 03 0 00 000005	OPRTBL:	ADD EXPVAL,AC
	401504'	265 14 0 00 401527'		JSP T,SUBSUB
	401505'	434 03 0 00 000005		IOR EXPVAL,AC
	401506'	404 03 0 00 000005		AND EXPVAL,AC
	401507'	430 03 0 00 000005		XOR EXPVAL,AC
	401510'	265 14 0 00 401542'		JSP T,MULSUB
	401511'	265 14 0 00 401550'		JSP T,DIVSUB
	401512'	265 14 0 00 401535'		JSP T,SHFSUB

	401513'	336 05 0 13 000000	TRMSUB:	SKIPN AC,(ARG)	;GET FIRST/NEXT FROM TABLE.
	401514'	254 00 0 12 000000		JRST 0(AC4)	;IF ZERO, EXIT.
	401515'	312 05 0 00 000150'		CAME AC,CHAR	;MATCH?
	401516'	252 13 0 00 401513'		AOBJP ARG,TRMSUB	;NO, ADV TO NEXT AND LOOP.
	401517'	554 11 0 00 000013		HLRZ OPR,ARG	;RETURN OPERATOR NUMBER IN OPR
	401520'	260740	402365'			GETCHR		;REPRIME THE SCANNER
	401521'	254 00 0 12 000001		JRST 1(AC4)

	401522'	202 07 0 00 000000'	MAKUND:	MOVEM NAME,UDFBLK+SYMN	;MAKE SYMBOL.  SAVE NAME.
	401523'	201 13 0 00 000000'		MOVEI ARG,UDFBLK	;INSERT SARCHETYPE.
	401524'	260 17 0 00 400050*		PUSHJ P,SINSRT
	401525'	254 04 0 00 000000		HALT		;**KLUDGE**
	401526'	263 17 0 00 000000		POPJ P,

	401527'	550 15 0 00 000005	SUBSUB:	HRRZ T1,AC	;ISOLATE VALUE PART OF FIRST OPERAND
	401530'	275 15 0 03 000000		SUBI T1,(EXPVAL)	;CALCULATE VALUE1-VALUE2.
	401531'	541 03 0 00 000000		HRRI EXPVAL,0
	401532'	277 05 0 00 000003		SUBB AC,EXPVAL	;CALCULATE MODE1-MODE2, LEAVE IN EXPVAL.
	401533'	540 03 0 00 000015		HRR EXPVAL,T1	;RESTORE VALUE PART.
	401534'	254 00 0 14 000000		JRST (T)

	401535'	250 03 0 00 000005	SHFSUB:	EXCH EXPVAL,AC	;SHIFT EXPVAL BY C(AC).
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4-1
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

	401536'	602 05 0 00 100000		TRNE AC,100000	;IF SHIFT QUANTITY IS NEGATIVE (16 BITS),
	401537'	435 05 0 00 600000		IORI AC,600000	;DO RIGHT SHIFT INSTEAD OF LEFT.
	401540'	242 03 0 05 000000		LSH EXPVAL,(AC)
	401541'	254 00 0 14 000000		JRST (T)
					;
	401542'	602 05 0 00 100000	MULSUB:	TRNE AC,100000	;SIGN EXTEND OPERAND 1.
	401543'	434 05 0 00 402471'		IOR AC,[777777600000]
	401544'	602 03 0 00 100000		TRNE EXPVAL,100000	;SIGN EXTEND OPERAND 2.
	401545'	434 03 0 00 402471'		IOR EXPVAL,[777777600000]
	401546'	220 03 0 00 000005		IMUL EXPVAL,AC	;MULTIPLY OPR 1* OPR 2
	401547'	254 00 0 14 000000		JRST (T)
					;
	401550'	602 05 0 00 100000	DIVSUB:	TRNE AC,100000	;SIGN EXTEND OPERAND 1.
	401551'	434 05 0 00 402471'		IOR AC,[777777600000]
	401552'	602 03 0 00 100000		TRNE EXPVAL,100000	;SIGN EXTEND OPERAND 2.
	401553'	434 03 0 00 402471'		IOR EXPVAL,[777777600000]
	401554'	233 05 0 00 000003		IDIVB AC,EXPVAL	;DIVIDE.
	401555'	254 00 0 14 000000		JRST (T)
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI:909/99/919 EXPRESSION ANALYZER, PAGE 5
					;FACTOR ANALYSIS.  WE TAKE A NON-SKIP RETURN ON NO FACTOR, A SKIP
					;RETURN (AFTER MARKING EXPRESSION AS NON-EMPTY) IF A FACTOR IS SEEN.

	401556'	400 03 0 00 000000	FACTOR:	SETZ EXPVAL,	;CLEAR RESULT.
	401557'	200 04 0 00 000150'		MCHR "."	;IS FACTOR PERIOD?
	401560'	306 04 0 00 000056
	401561'	254 00 0 00 401575'		JRST PERIOD	;YES.
	401562'	306 04 0 00 000042		CAIN CHR,042	;IS FACTOR A QUOTED LETTER?
	401563'	254 00 0 00 401627'		JRST QUOTE	;YES.
	401564'	260740	401304'			GETNAM		;NO, A SYMBOL?
	401565'	326 07 0 00 401600'		JUMPN NAME,SYMBOL	;YES.
	401566'	260740	401327'			GETNUM		;NO, A NUMBER.
	401567'	263 17 0 00 000000		POPJ P,		;NONE OF THE ABOVE, PUNT.
	401570'	334 03 0 00 000007		SKIPA EXPVAL,NUM	;A NUMBER, RETURN VALUE AS ABSOLUTE.
	401571'	660 01 0 00 000400	SETSR:	TRO AF,QSERR	;SYNTAX ERROR.
	401572'	621 01 0 00 010000	FND:	TLZ AF,QEMPTY	;SOMETHING FOUND, MARK EXPRESSION NON-EMPTY
	401573'	350 00 0 17 000000	CPOPJ1:	AOS (P)		;AND TAKE SKIP RETURN.
	401574'	263 17 0 00 000000		POPJ P,

	401575'	260740	402365'		PERIOD:	GETCHR		;PERIOD, ADVANCE TO NEXT CHARACTER.
	401576'	200 03 0 00 000153'		MOVE EXPVAL,CURLOC	;RESULT=CURRENT
	401577'	254 00 0 00 401572'		JRST FND	;LOCATION COUNTER.

	401600'	200 13 0 00 000007	SYMBOL:	MOVE ARG,NAME	;SYMBOL, LOOK UP THE NAME.
	401601'	260 17 0 00 401212*		PUSHJ P,LOOKUP
	401602'	254 00 0 00 401612'		JRST NTFND	;NOT FOUND.
	401603'	200 05 0 13 000002		MOVE AC,SYMF(ARG)	;FOUND, DEFINED?
	401604'	603 05 0 00 000200		TLNE AC,QUNV
	401605'	254 00 0 00 401614'		JRST UNDFD	;NO.
	401606'	200 03 0 13 000001		MOVE EXPVAL,SYMV(ARG)	;YES, RETURN VALUE.
	401607'	607 00 0 00 400000	CREXP:	TLNN F,QPASS1	;IF IN PASS2, CREF THIS REFERENCE.
	401610'	260 17 0 00 401171*		PUSHJ P,CREF
	401611'	254 00 0 00 401572'		JRST FND

	401612'	260 17 0 00 401522'	NTFND:	PUSHJ P,MAKUND	;NOT FOUND, CREATE AN ENTRY.
	401613'	254 00 0 00 401615'		JRST SETUFL	;SET ERROR FLAG.
	401614'	607 05 0 00 040000	UNDFD:	TLNN AC,QEXT	;FOUND, IF NOT EXTERN'D,
	401615'	660 01 0 00 000100	SETUFL:	TRO AF,QUERR	;MARK EXPRESSION AS ERRONEOUS.
	401616'	607 00 0 00 400000		TLNN F,QPASS1	;ARE WE IN PASS 2 AND
	401617'	607 01 0 00 002000		TLNN AF,QXTNON	;ARE EXTERNS PERMITTED?
	401620'	254 00 0 00 401607'		JRST CREXP	;NO.
	401621'	621 01 0 00 000400		TLZ AF,QXTNFR	;MARK EXPRESSION AS CONTAINING AN EXTERN.
	401622'	260 17 0 00 401610*		PUSHJ P,CREF	;CREF IF PASS 2.
	401623'	260 17 0 00 401703'		PUSHJ P,MAKBLK	;REFERENCE BLOCK.
	401624'	202 13 1 00 000351'		MOVEM ARG,@LEXPTR	;LINK BLOCK ONTO LOCAL LIST.
	401625'	202 13 0 00 000351'		MOVEM ARG,LEXPTR	;BLOCK IS NOW END OF LOCAL LIST.
	401626'	254 00 0 00 401572'		JRST FND	;DONE

	401627'	260740	402365'		QUOTE:	GETCHR		;QUOTED LETTER, ADVANCE TO NEXT CHARACTER.
	401630'	200 03 0 00 000150'		MOVE EXPVAL,CHAR	;GET CHARACTER.
	401631'	306 03 0 00 000015		CAIN EXPVAL,CRTN	;IF EOL, ERROR.
	401632'	254 00 0 00 401571'		JRST SETSR
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5-1
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

	401633'	435 03 0 00 000200		IORI EXPVAL,200	;OTHERWISE, FORCE 8TH BIT ON
	401634'	260740	402365'			GETCHR		;SKIP TO NEXT CHARACTER
	401635'	254 00 0 00 401572'		JRST FND	;AND RETURN.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI-909/99/919 EXPRESSION ANALYZER, PAGE 6
					;AT CLEANUP, WE HAVE A WHOLE RAFT OF SPECIAL CASES TO DISPOSE OF.
					;IN ORDER OF DIFFICULTY:
					;1.  EMPTY EXPRESSION, TAKE NON-SKIP RETURN
					;2.  EXPRESSION WITHOUT EXTERNS.
					;    2.1 UNINDEXED, RETURN VALUE
					;    2.2 INDEXED, RETURN VALUE WITH INDEX BIT SET AND SET SPECIAL
					;        FLAG BIT IF IN NORMAL DATA MODE
					;3.  EXPRESSION WITH EXTERNS.
					;    3.1 NON-SIMPLE EXPRESSION, CHAIN EXTERN REFERENCES ONTO MASTER
					;	 LIST
					;    3.2 SIMPLE EXPRESSION, CHAIN REFERENCE ONTO ONGOING CHAIN
					;	 OF REFERENCES LINKED THRU CORE
					;    3.3 INDEXED, CREATE SPECIAL INDEX BLOCK AND MERGE ONTO EXTERN
					;	 LIST
					;WATCH CLOSELY, AS THE BITS ARE FASTER THAN THE EYE.

	401636'	623 01 0 00 010000	CLNUP:	TLZE AF,QEMPTY	;EXPRESSION EMPTY?
	401637'	263 17 0 00 000000		POPJ P,		;YES, EXIT.
	401640'	350 00 0 17 000000		AOS ,(P)	;NO, SET UP SKIP RETURN.
	401641'	554 05 0 00 000003		HLRZ AC,EXPVAL	;GET RELOCATION VALUE.
	401642'	627 01 0 00 004000		TLZN AF,QRELON	;IS RELOCATION ENABLED? YES, SKIP
	401643'	326 05 0 00 401647'		JUMPN AC,SETRLX	;IF NOT, AND NOT ABSOLUTE, ERROR.
	401644'	363 05 0 00 401651'		SOJLE AC,RELOK	;IF 0/1, OK.
	401645'	306 05 0 00 777776		CAIN AC,777777-1	;IF -1, ALSO OK.
	401646'	254 00 0 00 401651'		JRST RELOK
	401647'	660 01 0 00 000002	SETRLX:	TRO AF,QRERR	;NOT OK, SET FLAG AND
	401650'	505 03 0 00 000000		HRLI EXPVAL,0	;FORCE RELOCATION MODE TO ABSOLUTE.
	401651'	332 05 0 00 000350'	RELOK:	SKIPE AC,LEXLST	;ANY EXTERN REFERENCES?
	401652'	254 00 0 00 401661'		JRST EXTNXP	;YES.
	401653'	627 01 0 00 040000		TLZN AF,QINDEX	;NO, INDEXED EXPRESSION?
	401654'	263 17 0 00 000000		POPJ P,		;EXIT IF NOT INDEXED.
	401655'	623 01 0 00 002000		TLZE AF,QXTNON	;INDEXED, SET INDEX BIT. ALSO SET FLAG
	401656'	664 03 0 00 500000		TROA EXPVAL,500000	;IF IN DATA NORMAL MODE.
	401657'	435 03 0 00 100000		IORI EXPVAL,100000
	401660'	263 17 0 00 000000		POPJ P,		;DONE.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI-909/99/919 EXPRESSION ANALYZER, PAGE 7
					;EXPRESSION WITH EXTERNALS.

	401661'	623 01 0 00 020000	EXTNXP:	TLZE AF,QSIMPL	;SIMPLE (SINGLE TERM) EXPRESSION?
	401662'	254 00 0 00 401674'		JRST SIMPLX	;YES.
	401663'	202 05 1 00 000353'		MOVEM AC,@MEXPTR	;NO, ADD LOCAL LIST ONTO MASTER LIST.
	401664'	200 06 0 00 000351'		MOVE AC1,LEXPTR	;END OF LOCAL LIST IS NOW END OF MASTER LIST.
	401665'	202 06 0 00 000353'		MOVEM AC1,MEXPTR
	401666'	623 01 0 00 040000	CHKIDX:	TLZE AF,QINDEX	;IF INDEXED, CREATE INDEX REFERENCE.
	401667'	260 17 0 00 401726'		PUSHJ P,MAKIDX
	401670'	201 05 0 00 000350'		MOVEI AC,LEXLST	;INITIALIZE LOCAL EXTERN LIST.
	401671'	202 05 0 00 000351'		MOVEM AC,LEXPTR
	401672'	402 00 0 00 000350'		SETZM ,LEXLST
	401673'	263 17 0 00 000000		POPJ P,		;EXIT.

					;ON A SIMPLE EXTERNAL EXPRESSION, THE ENTERNAL BLOCK GENERATED
					;BY THE EXPRESSION ANALYZER CONTAINS:
					; 0	LINK
					; 1	SYMBOL NAME
					; 2	ADDRESS OF THIS REFERENCE
					; 3	FLAGS
					;THE SYMBOL TABLE ENTRY CONTAINS (MOST IMPORTANTLY)
					; 1	ADDRESS OF LAST REFERENCE (OR -1 IF NONE YET)
					;WE MUST CHAIN, IE,
					;1. SYMBOL TABLE ENTRY IS UPDATED TO CONTAIN NEW "LAST" REFERENCE,
					;   TO WIT, THE CURRENT REFERENCE, FROM THE EXTERN BLOCK.
					;2. THE ADDRESS OF THE LAST REFERENCE IS RETURNED AS THE
					;   VALUE OF THE EXPRESSION;  PRESUMABLY, IT WILL BE PUT IN CORE.
					;THE EXTERN BLOCK IS THEN DEALLOCATED BY PUTTING ITS ADDRESS
					;IN LOCBLK.
					;THE ADDRESS OF THE FIRST(ONLY) EXTERN BLOCK IS IN AC.

	401674'	200 13 0 05 000001	SIMPLX:	MOVE ARG,SYMN+LINK(AC)	;RECOVER SYMBOL NAME.
	401675'	260 17 0 00 401601*		PUSHJ P,LOOKUP	;FIND IT AGAIN.
	401676'	254 04 0 00 000000		HALT		;***IT BETTER EXIST***
	401677'	200 03 0 05 000002		MOVE EXPVAL,SYMV+LINK(AC)	;GET CURRENT REFERENCE,
	401700'	250 03 0 13 000001		EXCH EXPVAL,SYMV(ARG)	;STORE AS OLD REF, GET OLD REF
									;AND RETURN AS VALUE.
	401701'	202 05 0 00 000354'		MOVEM AC,LOCBLK		;DEALLOCATE LAST ENTRY.
	401702'	254 00 0 00 401666'		JRST CHKIDX		;GO CHECK FOR INDEXING.


GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8
GRC	MAC	28-DEC-72 16:50		EXPRESSION ANALYZER

					;GRI-909/99/919 EXPRESSION ANALYZER, PAGE 8
					;MAKE AN EXPRESSION BLOCK FROM RAW BLOOD.
					;MAKBLK-- ENTER WITH A NAME IN 'NAME'
					;AND RUN LIKE HELL FROM THERE.

	401703'	332 13 0 00 000354'	MAKBLK:	SKIPE ARG,LOCBLK	;DO WE HAVE A BLOCK ALREADY?
	401704'	254 00 0 00 401710'		JRST GOTIT	;YES.
	401705'	201 13 0 00 000002		MOVEI ARG,2	;NO, ALLOCATE A 4 WORD BLOCK.
	401706'	260 17 0 00 000000*		PUSHJ P,ALLOC
	401707'	254 04 0 00 000000		HALT		;***KLUDGE***
	401710'	402 00 0 00 000354'	GOTIT:	SETZM ,LOCBLK	;IN ANY CASE, CLEAR LOCAL BLOCK LIST.
	401711'	202 07 0 13 000001		MOVEM NAME,SYMN+LINK(ARG)	;STORE NAME.
	401712'	200 05 0 00 000153'		MOVE AC,CURLOC	;REFERENCE IS AT CURLOC UNLESS WE ARE IN
	401713'	606 01 0 00 040000		TRNN AF,QTWO	;SINGLE WORD INSTRUCTION MODE, IN WHICH
	401714'	541 05 0 05 777777		HRRI AC,-1(AC)	;CASE REF IS AT CURLOC -1.  DO NOT DISTURB
								;REL. INFO IN LEFT HALF.
	401715'	202 05 0 13 000002		MOVEM AC,SYMV+LINK(ARG)	;STORE REFERENCE.
	401716'	200 06 0 11 401724'		MOVE AC1,FLTB(OPR)	;USE OPERATOR TO GET REFERENCE FLAGS.
	401717'	603 05 0 00 777777		TLNE AC,777777	;IF REFERENCE IS RELOCATABLE,
	401720'	661 06 0 00 040000		TLO AC1,GRIREL	;SET RELOCATED BIT IN FLAGS.
	401721'	202 06 0 13 000003		MOVEM AC1,SYMF+LINK(ARG)	;STORE FLAGS.
	401722'	402 00 0 13 000000		SETZM ,(ARG)	;CLEAR LINK WORD.
	401723'	263 17 0 00 000000		POPJ P,		;RETURN.


	401724'	020000	000000		FLTB:	GRIPLS,,0	;OPR=+
	401725'	010000	000000			GRIMIN,,0	;OPR=-

	401726'	200 07 0 00 402472'	MAKIDX:	MOVE NAME,[SIXBIT /[INDX]/]	;MAKE INDEX BLOCK WITH
	401727'	260 17 0 00 401703'		PUSHJ P,MAKBLK	;NAME '[INDX]'.
	401730'	202 13 1 00 000353'		MOVEM ARG,@MEXPTR	;LINK BLOCK ONTO MASTER EXTERN LIST.
	401731'	202 13 0 00 000353'		MOVEM ARG,MEXPTR	;BLOCK IS NOW END OF LIST.
	401732'	263 17 0 00 000000		POPJ P,		;EXIT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

						SUBTTL DATA AND SYMBOL PUNCH ROUTINES
					;
					;THE BINARY AND SYMBOL PUNCH ROUTINES ARE EXTREMELY CONFUSING,
					;BECAUSE OF THE LARGE NUMBER OF ROUTINES AND THE VARIETY
					;OF BLOCK FORMATS.  SOME PRELIMINARY INFORMATION:
					;
					;ALL BLOCKS CONSIST OF A THREE WORD HEADER + A BODY.  HEADER
					;FORMAT IS STANDARD:
					; 0	BLOCK TYPE
					; 1	CHECKSUM
					; 2	ITEM COUNT (NEGATIVE)
					;THERE ARE TWO DIFFERENT BLOCK TYPES, DATA (TYPE=03) AND
					;SYMBOL (TYPE=04/05).  WITHIN A DATA BLOCK, ITEMS ARE
					;ORGANIZED AS FOLLOWS:

					;EACH ITEM CONSISTS OF THREE BYTES:
					;BYTE 1		REL FLAG
					;BYTE 2,3	VALUE
					;THE FIRST DATA ITEM IN A DATA BLOCK IS THE BLOCK ORIGIN.
					;NOTE THAT FOR CHECKSUM PURPOSES, THE REL FLAG IS CONSIDERED
					;TO BE A 16 BIT VALUE, THE HIGH ORDER 8 BITS OF WHICH ZRE ZERO.
					;WITHIN THE PUNCH BUFFER, A THREE BYTE DATA ITEM IS STORED IN
					;ONE BUFFER LOCATION, AS FOLLOWS:
					;BITS 0-11	UNUSED
					; 12-19		REL FLAG
					; 20-35		DATA VALUE
					;HENCE IN PUNCHING A THREE BYTE ITEM, WE GET THREE BYTES FROM
					;THE SAME BUFFER WORD.

					;WITHIN A SYMBOL BLOCK, ITEMS ARE ORGANIZED AS FOLLOWS:
					;EACH ITEM CONSISTS OF 6 BYTES:
					;BYTES 1-4	RADIX 50 SYMBOL NAME
					;BITS 15-11 OF BYTE 3 ARE FLAGS
					;BYTES 5-6	SYMBOL VALUE
					;WITHIN THE PUNCH BUFFER, ITEMS ARE STORED 2 BYTES/PDP-10 WORD
					;AND TAKE 3 WORDS.
					;
					;
					;
					;
					;THIS SECTION CONTAINS THE FOLLOWING ROUTINES:
					;PENTDC		PUNCH ENTRY DICTIONARY
					;PEXTDC		PUNCH EXTERN DICTIONARY
					;PARITH		PUNCH THE EXTERNAL ARITHMETIC DICTIONARY
					;PUNCH		PUNCH A BINARY DATA ITEM
					;OTPDCN		FORCE OUTPUT OF DICTIONARY BLOCK
					;OTPDAT		FORCE OUTPUT OF DATA BLOCK
					;
					;PLUS THE USUAL RAFT OF SUPPORTING SUBROUTINES AND MISC. GARBAGE
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI-909/99/919 PUNCH ROUTINES, PAGE 2
					;PENTDC-- PUNCH ENTRY DICTIONARY, WHICH IS THE FIRST THING ON
					;THE OUTPUT TAPE.
					;
	401733'	603 00 0 00 200000	PENTDC:	TLNE F,QNOBIN	;ANY BINARY OUTPUT?
	401734'	263 17 0 00 000000		POPJ P,	;NO, EXIT
	401735'	201 13 0 00 000004		MOVEI ARG,4	;YES, INITIALIZE PUNCH BUFFER FOR
	401736'	265 16 0 00 402145'		JSP T2,INDCBF	;ENTRY DICTIONARY (BLOCK TYPE 04).
	401737'	260 17 0 00 000000*		PUSHJ P,INITNX	;INITIALIZE 'NEXT SYMBOL' ROUTINE.
	401740'	260 17 0 00 000000*	ENTDCL:	PUSHJ P,NXTSYM	;GET NEXT SYMBOL.
	401741'	322 13 0 00 401753'		JUMPE ARG,ENDDC	;NONE LEFT, DONE.
	401742'	200 05 0 13 000002		MOVE AC,SYMF(ARG)	;GET FLAGS.
	401743'	603 05 0 00 020000		TLNE AC,QENT	;IS IT A DEFINED ENTRY POINT?
	401744'	603 05 0 00 000200		TLNE AC,QUNV
	401745'	254 00 0 00 401740'		JRST ENTDCL	;NO, IGNORE.
	401746'	201 02 0 00 100000		MOVEI FLGS,GRIENT	;YES, BASIC FLAG IS 'ENTRY POINT'.
	401747'	554 05 0 13 000001		HLRZ AC,SYMV(ARG)	;SET OTHER FLAGS BASED ON
	401750'	434 02 0 05 401757'		IOR FLGS,ENTFLG+RELBAS(AC)	;RELOCATABILITY.
	401751'	260 17 0 00 402007'		PUSHJ P,PDICTN	;PUNCH DICTIONARY ENTRY.
	401752'	254 00 0 00 401740'		JRST ENTDCL	;GO DO MORE.

	401753'	623 01 0 00 001000	ENDDC:	TLZE AF,QNYDAT	;IF ANYTHING FOUND IN DICTIONARY, THEN
	401754'	260 17 0 00 402110'		PUSHJ P,OTPDCN	;AT END, FORCE OUTPUT OF BLOCK.
	401755'	263 17 0 00 000000		POPJ P,		;EXIT.

	401756'	000000	060000		ENTFLG:	GRIPLS+GRIREL	;NEG ENTRY POINT IS MARKED AS POS REF/REL
	401757'	000 00 0 00 000000		Z		;ABS ENTRY POINT
	401760'	000000	040000			GRIREL		;NORMAL ENTRY POINT

					;PEXTDC-- PUNCH EXTERN DICTIONARY, VERY SIMILAR TO ABOVE.

	401761'	603 00 0 00 200000	PEXTDC:	TLNE F,QNOBIN	;BINARY OUTPUT?
	401762'	263 17 0 00 000000		POPJ P,		;NO, EXIT.
	401763'	201 13 0 00 000005		MOVEI ARG,5	;YES, INITIALIZE PUNCH BUFFER FOR
	401764'	265 16 0 00 402145'		JSP T2,INDCBF	;EXTERN DICTIONARY (BLOCK TYPE 05).
	401765'	260 17 0 00 401737*		PUSHJ P,INITNX	;INITIALIZE 'NEXT SYMBOL' ROUTINE.
	401766'	260 17 0 00 401740*	EXTDCL:	PUSHJ P,NXTSYM	;GET NEXT SYMBOL.
	401767'	322 13 0 00 401777'		JUMPE ARG,PARITH	;DONE, GO ONTO EXTERNAL ARITHMETIC.
	401770'	200 05 0 13 000002		MOVE AC,SYMF(ARG)	;GET FLAGS. UNDEFINED?
	401771'	607 05 0 00 000200		TLNN AC,QUNV
	401772'	254 00 0 00 401766'		JRST EXTDCL	;NO, IGNORE.
	401773'	554 05 0 13 000001		HLRZ AC,SYMV(ARG)	;YES, GET RELOCATION FLAG.
	401774'	200 02 0 05 401757'		MOVE FLGS,ENTFLG+RELBAS(AC)
	401775'	260 17 0 00 402007'		PUSHJ P,PDICTN	;PUNCH ENTRY.
	401776'	254 00 0 00 401766'		JRST EXTDCL	;ON TO NEXT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 3
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI-909/99/919 PUNCH ROUTINES, PAGE 3
					;PARITH-- PUNCH ARITHMETIC REFERENCES.

	401777'	336 13 0 00 000352'	PARITH:	SKIPN ARG,MEXLST	;IS THE MASTER EXTERNAL LIST EMPTY?
	402000'	254 00 0 00 401753'		JRST ENDDC	;YES, DONE.
	402001'	200 05 0 13 000000		MOVE AC,(ARG)	;GET LINK TO NEXT
	402002'	202 05 0 00 000352'		MOVEM AC,MEXLST	;AND SAVE AS NEW START OF LIST
	402003'	271 13 0 00 000001		ADDI ARG,LINK	;ADVANCE TO BODY OF REFERENCE.
	402004'	554 02 0 13 000002		HLRZ FLGS,SYMF(ARG)	;GET FLAGS.
	402005'	260 17 0 00 402007'		PUSHJ P,PDICTN	;GO PUNCH.
	402006'	254 00 0 00 401777'		JRST PARITH	;ON TO NEXT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI-909/99/919 PUNCH ROUTINES, PAGE 4
					;PDICTN-- PUNCH A DICTIONARY ENTRY.  FLAGS ARE
					;IN FLGS, ALREADY TRANSLATED TO GRI FORMAT.  THE SYMBOL BLOCK
					;IS POINTED TO BY ARG.

	402007'	661 01 0 00 001000	PDICTN:	TLO AF,QNYDAT	;ENTRY FOUND, SET "ANY DATA" FLAG.
	402010'	200 05 0 00 000004'		MOVE AC,PUNPSN	;GET POINTER INTO PUNCH BUFFER.
	402011'	305 05 0 00 000140		CAIGE AC,PUNMAX	;IS BUFFER FULL?
	402012'	254 00 0 00 402017'		JRST NOPUN	;NO.
	402013'	261 17 0 00 000013		PUSH P,ARG	;YES, SAVE ARGUMENT.
	402014'	260 17 0 00 402110'		PUSHJ P,OTPDCN	;PUNCH BUFFER.
	402015'	265700	402147'			BFINIT		;REINITIALIZE.
	402016'	262 17 0 00 000013		POP P,ARG	;RECOVER ARGUMENT.
	402017'	200 05 0 13 000000	NOPUN:	MOVE AC,SYMN(ARG)	;GET SYMBOL NAME.
	402020'	316 05 0 00 402472'		CAMN AC,[SIXBIT /[INDX]/]	;IS IT INDEX BLOCK?
	402021'	254 00 0 00 402034'		JRST INDXBL	;YES.
	402022'	201 15 0 00 000003		MOVEI T1,3	;NO, CONVERT 3 CHARACTERS TO RADIX 50
	402023'	265700	402054'			RAD50C
	402024'	265700	402101'			BFINST		;AND STORE IN BUFFER.
	402025'	201 15 0 00 000002		MOVEI T1,2	;CONVERT 2 MORE CHARACTERS TO RADIX 50
	402026'	265700	402054'			RAD50C
	402027'	434 14 0 00 000002		IOR T,FLGS	;OR IN GRI MODE FLAGS.
	402030'	265700	402101'		INSPT2:	BFINST		;INSERT IN PUNCH BUFFER.
	402031'	200 14 0 13 000001		MOVE T,SYMV(ARG)
	402032'	265700	402101'			BFINST		;INSERT VALUE OF SYMBOL.
	402033'	263 17 0 00 000000		POPJ P,		;EXIT.

	402034'	201 14 0 00 177777	INDXBL:	MOVEI T,177777	;INDEX BLOCK, NAME IS -1.
	402035'	265700	402101'			BFINST
	402036'	200 14 0 00 000002		MOVE T,FLGS	;SECOND PART OF NAME IS BLANK.
	402037'	254 00 0 00 402030'		JRST INSPT2	;GO INSERT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI-909/99/919 PUNCH ROUTINES, PAGE 5
					;PUNCH-- PUNCH A DATA ITEM IN ARG.

	402040'	603 00 0 00 604000	PUNCH:	TLNE F,QPASS1+QBINOFF+QNOBIN	;PUNCHING OFF?
	402041'	254 00 0 00 402052'		JRST INCRXT	;YES, BYPASS PUNCHING.
	402042'	200 05 0 00 000004'		MOVE AC,PUNPSN	;PUNCH OVERFLOW?
	402043'	305 05 0 00 000140		CAIGE AC,PUNMAX
	402044'	254 00 0 00 402051'		JRST NOPNCH	;NO.
	402045'	261 17 0 00 000013		PUSH P,ARG	;SAVE ARGUMENT.
	402046'	260 17 0 00 402113'		PUSHJ P,OTPDAT	;YES, OUTPUT DATA ITEMS.
	402047'	260 17 0 00 402154'		PUSHJ P,INDBNT	;REINITIALIZE THE PUNCH BUFFER.
	402050'	262 17 0 00 000013		POP P,ARG	;RESTORE ARGUMENT.
	402051'	265700	402072'		NOPNCH:	BFCNVT		;CONVERT ARGUMENT AND STORE IN BUFFER.
	402052'	350 00 0 00 000153'	INCRXT:	AOS ,CURLOC	;ADVANCE LOCATION COUNTER.
	402053'	263 17 0 00 000000		POPJ P,		;EXIT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI-909/99/919 PUNCH ROUTINES, PAGE 6
					;SUPPORTING CAST OF THOUSANDS--
					;RAD50S  RADIX 50 CONVERSION
					;BUFINS  INSERT DATA ITEM IN BUFFER
					;BFCNVT  INSERT 3 BYTE DATA ITEM IN BUFFER
					;
					;RAD50S IS CALLED BY JSP T2,RAD50S WITH COUNT IN T1, SIXBIT
					;SYMBOL IN AC.  VALUE IS RETURNED IN T.

	402054'	400 14 0 00 000000	RAD50S:	SETZ T,		;CLEAR RESULT.
	402055'	400 06 0 00 000000	RAD50L:	SETZ AC+1,	;ISOLATE HIGH ORDER SIXBIT
	402056'	245 05 0 00 000006		ROTC AC,6	;CHARACTER.
	402057'	322 06 0 00 402066'		JUMPE AC+1,R50MUL	;BLANK GOES THRU AS ZERO.
	402060'	301 06 0 00 000040		CAIL AC+1,'@'	;IS IT @ THRU Z?
	402061'	254 00 0 00 402065'		JRST ALPHA	;YES
	402062'	305 06 0 00 000020		CAIGE AC+1,'0'	;IS IT NUMBER OR SPECIAL?
	402063'	271 06 0 00 000012	SPCL:	ADDI AC+1,12	;(4:5) +12-15 = (1:2)
	402064'	271 06 0 00 000006		ADDI AC+1,6	;(20:31) +6-23 = (3:14)
	402065'	275 06 0 00 000023	ALPHA:	SUBI AC+1,23	;(40:72) -23 = (15:47)
	402066'	221 14 0 00 000050	R50MUL:	IMULI T,50	;MULTIPLY RESULT BY 50 AND
	402067'	270 14 0 00 000006		ADD T,AC+1	;ADD IN CONVERTED CHARACTER.
	402070'	367 15 0 00 402055'		SOJG T1,RAD50L	;DECREMENT COUNT, BRANCH BACK IF NOT DONE.
	402071'	254 00 0 16 000000		JRST (T2)	;EXIT

					;BUFCVT IS CALLED WITH DATA WORD IN ARG.
					;BUFINS IS CALLED WITH DATA ITEM IN T.  THEY INTERLINK AS
					;FOLLOWS:

	402072'	554 15 0 00 000013	BUFCVT:	HLRZ T1,ARG	;GET RELOCATION BITS.
	402073'	550 14 0 15 402106'		HRRZ T,RELBYT+RELBAS(T1)	;CONVERT TO PUNCHABLE FRM.
	402074'	622 13 0 00 400000		TRZE ARG,400000	;IF INDEXED,
	402075'	435 14 0 00 000200		IORI T,200	;SET INDEX BIT IN RELOCATION BYTE.
	402076'	272 14 0 00 000006'		ADDM T,PUNSUM	;ADD INTO CHECKSUM.
	402077'	242 14 0 00 000020		LSH T,^D16	;MOVE INTO PLACE AND
	402100'	435 14 0 13 000000		IORI T,(ARG)	;OR IN ARGUMENT.
	402101'	272 14 0 00 000006'	BUFINS:	ADDM T,PUNSUM	;ADD RESULT INTO CHECKSUM.
	402102'	350 15 0 00 000004'		AOS T1,PUNPSN	;INCREMENT PUNCH POINTER AND
	402103'	202 14 0 15 000007'		MOVEM T,PUNBUF-1(T1)	;STORE PUNCH DATA.
	402104'	254 00 0 16 000000		JRST (T2)

	402105'	000000	000002		RELBYT:	2	;NEG REL
	402106'	000000	000000			0	;ABS
	402107'	000000	000001			1	;NORMAL
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI909/99/919 PUNCH ROUTINES, PAGE 7
					;AT LAST, PUNCH A BUFFER FULL OF GOODIES.
					;NOTE THAT WE MUST CAREFULLY DISTINGUISH BETWEEN SYMBOL
					;AND DATA BLOCKS.

	402110'	200 05 0 00 000004'	OTPDCN:	MOVE AC,PUNPSN	;IN A DICTIONARY BLOCK, THE NUMBER OF
	402111'	231 05 0 00 000003		IDIVI AC,3	;DATA ITEMS = NUMBER OF BUFFER WORDS/3
	402112'	254 00 0 00 402114'		JRST OTPCMN
	402113'	200 05 0 00 000004'	OTPDAT:	MOVE AC,PUNPSN	;IN A DATA BLOCK, DATA ITEMS= BUFFER WORDS
	402114'	212 05 0 00 000007'	OTPCMN:	MOVNM AC,PUNCNT	;STORE NEGATIVE ITEM COUNT IN PUNCH COUNT.
	402115'	276 05 0 00 000006'		SUBM AC,PUNSUM	;ADD NEGATED COUNT INTO CHECKSUM AND
								;NEGATE CHECKSUM.
	402116'	200 10 0 00 000005'		MOVE AC2,PNBFST	;GET BUFFER HEADER AS SWITCH.
	402117'	201 11 0 00 000003		MOVEI AC3,3	;SET INITIAL COUNT OF 3, FOR HEADER.
	402120'	201 06 0 00 000005'		MOVEI AC1,PNBFST	;START PUNCHING AT DEADER.
	402121'	200 05 0 00 000004'		MOVE AC,PUNPSN	;NUMBER OF WORDS TO PUNCH IS 2ND COUNT.
	402122'	505 06 0 00 201000	PUNLP2:	HRLI AC1,(POINT 8,,19)	;SET UP BYTE POINTER.
	402123'	134 13 0 00 000006	PUNCMN:	ILDB ARG,AC1	;BYTE POINTER AND GET BYTE.
	402124'	260 17 0 00 400031*		PUSHJ P,$WRWRD	;WRITE IT OUT.
	402125'	134 13 0 00 000006		ILDB ARG,AC1	;GET NEXT BYTE.
	402126'	260 17 0 00 402124*		PUSHJ P,$WRWRD	;WRITE IT OUT.
	402127'	271 06 0 00 000001		ADDI AC1,1	;ADVANCE TO NEXT BUFFER WORD.
	402130'	367 11 0 00 402122'		SOJG AC3,PUNLP2	;DECREMENT OUTSIDE CNT, BR BACK IF NOT DONE.
	402131'	361 05 0 00 402140'		SOJL AC,PUNDON	;DONE WITH HEADER, CHECK FOR END OF DATA.
	402132'	302 10 0 00 000003		CAIE AC2,3	;DATA OK.  DATA BLOCK BEING PUNCHED?
	402133'	254 00 0 00 402122'		JRST PUNLP2	;NO, KEEP PUNCHING TWO BYTES PER BUFFER WORD.
	402134'	505 06 0 00 301000		HRLI AC1,(POINT 8,,11)	;YES, PUNCH THREE.
	402135'	134 13 0 00 000006		ILDB ARG,AC1
	402136'	260 17 0 00 402126*		PUSHJ P,$WRWRD
	402137'	254 00 0 00 402123'		JRST PUNCMN

	402140'				PUNDON:
	402140'	201 05 0 00 000011	PUNLDR:	MOVEI AC,^D9	;PUNCH 9 BLANK FRAMES BETWEEN BLOCKS.
	402141'	400 13 0 00 000000		SETZ ARG,
	402142'	260 17 0 00 402136*		PUSHJ P,$WRWRD
	402143'	367 05 0 00 402142'		SOJG AC,.-1
	402144'	263 17 0 00 000000		POPJ P,		;EXIT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8
GRD	MAC	14-JUN-72 14:03		DATA AND SYMBOL PUNCH ROUTINES

					;GRI-909/99/919 PUNCH ROUTINES, PAGE 8
					;INITIALIZATION ROUTINES, IN MANY FLAVORS.

	402145'	621 01 0 00 001000	INDCBF:	TLZ AF,QNYDAT	;INITIALIZE ANY DATA FLAG.
	402146'	202 13 0 00 000005'		MOVEM ARG,PNBFST	;INITILIZE DICTN BUF, SAVE BLOCK TYPE.
	402147'	402 00 0 00 000006'	INDCNT:	SETZM ,PUNSUM	;INITIALIZE COUNTS-- CHECKSUM,
	402150'	402 00 0 00 000007'		SETZM ,PUNCNT	;COUNT,
	402151'	402 00 0 00 000004'		SETZM ,PUNPSN	;BUFFER POSITION.
	402152'	254 00 0 16 000000		JRST (T2)	;EXIT.

	402153'	202 13 0 00 000005'	INDBBF:	MOVEM ARG,PNBFST
	402154'	265700	402147'		INDBNT:	BFINIT
	402155'	200 13 0 00 000153'		MOVE ARG,CURLOC	;STORE LOCATION COUNTER AS FIRST DATA ITEM
	402156'	265700	402072'			BFCNVT		;OF NEW BUFFER.
	402157'	263 17 0 00 000000		POPJ P,
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

						SUBTTL INPUT, OUTPUT, AND SUPPORT ROUTINES

					;OUTPUT--OUTPUT RESULT OF ASSEMBLY PROCESS.
					;INPUTS INCLUDE:
					;$CRFNO CREF LINE#
					;CURLOC CURRENT ASSEMBLER LOCATION
					;WORD1 FIRST WORD OF OUTPUT
					;WORD2 SECOND WORD OF OUTPUT (IN ANY)
					;RELEVANT FLAGS (RIGHT HALF OF AF):
					;QLOC	PRINT LOCATION COUNTER
					;QVAL	PRINT WORD1 DATA
					;QCREF	PRINT CREF LINE#
					;QTWO	PRINT WORD2 DATA
					;QPUN	PUNCH WORD1 DATA (WORD2 IS ALWAYS PUNCHED IF PRESENT)
					;QLIN	PRINT LINE BUFFER
					;QINF	PRINT WORD1 IN INSTRUCTION FORM

	402160'	603 00 0 00 400000	OUTPUT:	TLNE F,QPASS1		;ARE WE IN PASS2?
	402161'	254 00 0 00 402325'		JRST PASS1X	;NO, GO INCREMENT CURLOC.
	402162'	627 01 0 00 100000		TLZN AF,QFF	;FORM FEED SEEN IN THIS LINE?
	402163'	254 00 0 00 402166'		JRST .+3	;NO.
	402164'	201 13 0 00 000014		PRC FFEED	;YES, PRINT IT BEFORE ANYTHING ELSE.
	402165'	260 17 0 00 000000*
	402166'	603 00 0 00 001000		TLNE F,QCREF		;ARE WE IN CREF MODE?
	402167'	606 01 0 00 020000		TRNN AF,QLIN		;YES, IS THERE AN INPUT LINE.
	402170'	254 00 0 00 402173'		JRST NOCREF		;NO CREF OR NO LINE, JUMP.
	402171'	200 13 0 00 000000*		MOVE ARG,$CRFNO		;OTHERWISE, PRINT CREF LINE#
	402172'	260 17 0 00 402350'		PUSHJ P,PRCREF
	402173'	602 01 0 00 007777	NOCREF:	TRNE AF,ALLERR		;ANY ERRORS?
	402174'	260 17 0 00 402277'		PUSHJ P,PRERRS		;YES, PRINT THEM.
	402175'	201 13 0 00 000011		PRC "	"		;TAB OVER
	402176'	260 17 0 00 402165*
	402177'	606 01 0 00 400000		TRNN AF,QLOC		;AND CHECK FOR LOCATION FIELD PRINT

	402200'	254 00 0 00 402203'		JRST  NOLOCN		;IF NOT SPECIFIED, DONT PRINT.
	402201'	200 13 0 00 000153'		MOVE ARG,CURLOC		;OTHERWISE, PRINT AS 6 DIGIT OCTAL
	402202'	260 17 0 00 402354'		PUSHJ P,PROCTR		;INTEGER, WITH RELOCATION.

	402203'	201 13 0 00 000011	NOLOCN:	PRC "	"		;TAB OVER.
	402204'	260 17 0 00 402176*
	402205'	606 01 0 00 200000		TRNN AF,QVAL		;PRINT VALUE FIELD?
	402206'	254 00 0 00 402213'		JRST NODATA		;NO, SKIP
	402207'	200 13 0 00 000154'		MOVE ARG,WORD1		;YES, GET WORD1.
	402210'	602 01 0 00 010000		TRNE AF,QPUN		;PUNCH IT?
	402211'	260 17 0 00 402040'		PUSHJ P,PUNCH		;YES.
	402212'	260 17 0 00 402354'		PUSHJ P,PROCTR		;IN ANY CASE, PRINT AS 6 DIGIT INTEGER.
	402213'	201 13 0 00 000011	NODATA:	PRC "	"		;TAB OVER. INSTRUCTION MODE FLAG SET?
	402214'	260 17 0 00 402204*
	402215'	602 00 0 00 000004		TRNE F,QNOINF	;FIRST, CHECK TO SEE IF INSTRUCTION MODE
	402216'	254 00 0 00 402244'		JRST NOTABS	;TYPEOUT SUPPRESSED COMPLETELY.
	402217'	606 01 0 00 100000		TRNN AF,QINF		;IF NOT, TAB OVER TWICE.
	402220'	254 00 0 00 402240'		JRST NOINS
	402221'	201 13 0 00 000050		PRC "("			;PRINT OPENING PARENTHESIS.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 1-1
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

	402222'	260 17 0 00 402214*
	402223'	135 13 0 00 402456'		LDB ARG,SRCPTR		;PRINT SOURCE AS 2 DIGIT OCTAL NUMBER
	402224'	260 17 0 00 402333'		PUSHJ P,PROCT2
	402225'	201 13 0 00 000040		PRC " "			;SPACE OVER AND
	402226'	260 17 0 00 402222*
	402227'	135 13 0 00 402455'		LDB ARG,MODPTR		;PRINT MOD FIELD AS 4 DIGIT BINARY NUMBER
	402230'	260 17 0 00 402345'		PUSHJ P,PRBIN4
	402231'	201 13 0 00 000040		PRC " "			;SPACE OVER AND
	402232'	260 17 0 00 402226*
	402233'	135 13 0 00 402457'		LDB ARG,DSTPTR		;PRINT DESTINATION FIELD AS 2 DIGIT OCTAL
	402234'	260 17 0 00 402333'		PUSHJ P,PROCT2		;INTEGER.
	402235'	201 13 0 00 000051		PRC ")"			;CLOSE OFF SPECIAL PRINT.
	402236'	260 17 0 00 402232*
	402237'	254 00 0 00 402242'		JRST INSFM		;TAB OVER ONCE.
	402240'	201 13 0 00 000011	NOINS:	PRC "	"		;IF NO INSTRUCTION, TAB OVER TWICE.
	402241'	260 17 0 00 402236*
	402242'	201 13 0 00 000011	INSFM:	PRC "	"
	402243'	260 17 0 00 402241*
	402244'	606 01 0 00 020000	NOTABS:	TRNN AF,QLIN	;IS THERE A LINE OF INPUT TO PRINT?
	402245'	254 00 0 00 402261'		JRST NOLINE	;NO, GO TYPE CR,LF.




GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

					;PAGE 2

					;GRI-909 ASSEMBLER, PART C, PAGE 2

					;OUTPUT ROUTINE CONTD.

	402246'	336 00 0 00 000000*	PRLINE:	SKIPN $SQNUM		;PRINT LINE... ANY SEQUENCE NUMBER?
	402247'	254 00 0 00 402254'		JRST NOSEQN		;NO.
	402250'	201 13 0 00 402246*		MOVEI ARG,$SQNUM	;YES, PRINT IT WITH A
	402251'	260 17 0 00 000000*		PUSHJ P,$WRLIN		;TRAILING TAB.
	402252'	201 13 0 00 000011		PRC "	"
	402253'	260 17 0 00 402243*

	402254'	201 05 0 00 000000	NOSEQN:	MOVEI AC,0		;PREPARE APTR INTO THE BUFFER.
	402255'	336 13 0 05 000157'		SKIPN ARG,LINBUF(AC)	;NEXT CHARACTER ZERO?
	402256'	254 00 0 00 402262'		JRST CHKTWO		;YES, DONE.
	402257'	260 17 0 00 402253*		PUSHJ P,$WRCHR		;WRITE CHARACTER, ADVANCE TO NEXT.
	402260'	344 05 0 00 402255'		AOJA AC,NOSEQN+1

	402261'	260 17 0 00 000000*	NOLINE:	PUSHJ P,WRCRLF		;IF NO INPUT, PUT OUT CR-LF.
	402262'	621 00 0 00 000001	CHKTWO:	TLZ F,QERROR		;CLEAR ERROR
	402263'	626 01 0 00 040000		TRZN AF,QTWO		;FLAG AND CHECK FOR TWO LINE CONDITION.
	402264'	263 17 0 00 000000		POPJ P,			;EXIT IF SINGLE LINE.
	402265'	201 13 0 00 000011		PRC "	"		;SECOND LINE ALWAYS CONSISTS OF LOCATION
	402266'	260 17 0 00 402257*
	402267'	200 13 0 00 000153'		MOVE ARG,CURLOC		;AND NORMAL DATA.
	402270'	260 17 0 00 402354'		PUSHJ P,PROCTR
	402271'	201 13 0 00 000011		PRC "	"
	402272'	260 17 0 00 402266*
	402273'	200 13 0 00 000155'		MOVE ARG,WORD2		;WORD2 IS ALWAYS PUNCHED AS WELL AS PRINTED.
	402274'	260 17 0 00 402040'		PUSHJ P,PUNCH
	402275'	260 17 0 00 402354'		PUSHJ P,PROCTR
	402276'	254 00 0 00 402261'		JRST NOLINE		;GO DO CR-LF. TWOLINE FLAG HAS BEEN CLEARED,
									;SO WE WILL EXIT AUTOMATICALLY.

	402277'	661 00 0 00 000001	PRERRS:	TLO F,QERROR		;ERRORS PRESENT... SET ERROR IN LINE FLAG.
	402300'	205 06 0 00 777764		MOVSI AC1,-ERCNT	;SET UP POINTER/COUNTER TO ERRTBL.
	402301'	550 05 0 06 402311'	ROTERR:	HRRZ AC,ERRCHR(AC1)	;GET NEXT ERROR MASK.
	402302'	636 01 0 00 000005		TDZN AF,AC		;IS CORRESPONDING ERROR BIT SET IN AF?
	402303'	254 00 0 00 402307'		JRST CLOOPR		;NO, GO ON TO NEXT.
	402304'	554 13 0 06 402311'		HLRZ ARG,ERRCHR(AC1)	;YES, GET CORRESPONDING CHAR
	402305'	260 17 0 00 402272*		PUSHJ P,$WRCHR		;AND PRINT IT.
	402306'	350 00 0 00 000000*		AOS ,$ERCNT	;INCREMENT MASTER ERROR COUNT.
	402307'	253 06 0 00 402301'	CLOOPR:	AOBJN AC1,ROTERR	;ADVANCE PTR/CNTR. DONE?
	402310'				WRTFLG:
	402310'	263 17 0 00 000000	CPOPJ:	POPJ P,			;YES, EXIT.

	402311'	000127	000010		ERRCHR:	"W",,QEERR
	402312'	000076	000020			">",,QTMERR
	402313'	000074	000040			"<",,QTFERR
	402314'	000125	000100			"U",,QUERR
	402315'	000101	000200			"A",,QXERR
	402316'	000123	000400			"S",,QSERR
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 2-1
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

	402317'	000104	001000			"D",,QDERR
	402320'	000115	002000			"M",,QMERR
	402321'	000130	000004			"X",,QXTERR
	402322'	000122	000002			"R",,QRERR
	402323'	000116	000001			"N",,QNERR
	402324'	000120	004000			"P",,QPERR
			000014			ERCNT=.-ERRCHR






	402325'	606 01 0 00 010000	PASS1X:	TRNN AF,QPUN	;DURING PASS 1:  ANYTHING TO PUNCH?
	402326'	263 17 0 00 000000		POPJ P,	;NO, EXIT.
	402327'	350 00 0 00 000153'		AOS ,CURLOC	;YES, ADVANCE AT LEAST ONE LOCATION.
	402330'	622 01 0 00 040000		TRZE AF,QTWO	;TWO WORDS TO PUNCH?
	402331'	350 00 0 00 000153'		AOS ,CURLOC	;YES, INCREMENT AGAIN.
	402332'	263 17 0 00 000000		POPJ P,	;EXIT.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 3
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

					;GRI-909 ASSEMBLER, PART C, PAGE 3

					;INTEGER OUTPUT ROUTINES. ALL BASICALLY USE "WRTINT" TO
					;PUT OUT VARIOUS FORMATS AND RACIDES. WRTINT HAS THREE
					;PARAMETERS:	NRADIX:	RADIX
					;NBITS:	BIT WIDTH
					;LEADER:	LEADING SPACE/ZERO CHARACTER
						EXTERN NRADIX,NBITS,WRTINT,WRTNOL, VALUE,LEADER
						EXTERN $CRFNO,$ERCNT

	402333'	201 10 0 00 000006	PROCT2:	MOVEI AC2,6		;2 OCTAL DIGITS:	BIT WIDTH IS 6.
	402334'	254 00 0 00 402336'		JRST PROCTL
						INTERN PRSYMB
	402335'	201 10 0 00 000020	PROCT6:	MOVEI AC2,^D16		;6 OCTAL DIGITS:	WIDTH IS 16 BITS.
	402336'	201 06 0 00 000010	PROCTL:	MOVEI AC1,^D8		;RADIX IS 8.
	402337'	201 05 0 00 000060	PRSTD:	MOVEI AC,"0"		;FILL CHARACTER IS ZERO.
	402340'	202 10 0 00 000000*	PRSTO:	MOVEM AC2,NBITS		;STORE BIT WIDTH.
	402341'	202 06 0 00 000000*		MOVEM AC1,NRADIX	;STORE RADIX.
	402342'	202 05 0 00 000000*		MOVEM AC,LEADER		;STORE FILL CHARACTER.
	402343'	202 13 0 00 000000*		MOVEM ARG,VALUE		;STORE ARGUMENT.
	402344'	254 00 0 00 000000*		PJRST WRTINT		;GO PUT OUT WITH LEADING CHARACTERS.

	402345'	201 10 0 00 000004	PRBIN4:	MOVEI AC2,4		;4 BINARY DIGITS:	WIDTH 4
	402346'	201 06 0 00 000002		MOVEI AC1,2		;RADIX 2
	402347'	254 00 0 00 402337'		JRST PRSTD		;GO PRINT

	402350'	201 10 0 00 000020	PRCREF:	MOVEI AC2,^D16		;CREF NUMBERS ARE
	402351'	201 06 0 00 000012		MOVEI AC1,^D10		;16 BITS, BASE 10, WITH LEADING SPACES.
	402352'	201 05 0 00 000040		MOVEI AC," "
	402353'	254 00 0 00 402340'		JRST PRSTO		;GO PRINT






	402354'				PRSYMB:
	402354'	556 13 0 00 000355'	PROCTR:	HLRZM ARG,SAVNAM	;SAME RELOCATION FLAG FOR LATER.
	402355'	260 17 0 00 402335'		PUSHJ P,PROCT6	;PRINT 6 OCTAL DIGITS.
	402356'	550 05 0 00 000355'		HRRZ AC,SAVNAM	;RECOVER RELOCATION FLAG.
	402357'	332 13 0 05 402363'		SKIPE ARG,CHRTB+RELBAS(AC)	;GET REL. CHAR FOR FLAG.
	402360'	254 00 0 00 402305*		PJRST $WRCHR	;GO PRINT CHARACTER.
	402361'	263 17 0 00 000000		POPJ P,	;IF NONE, RETURN.
	402362'	000000	000055		CHRTB:	"-"	;-1, NEG. REL
	402363'	000 00 0 00 000000		Z	;0, ABSOLUTE, NO PRINT
	402364'	000000	000047			"'"	;1, RELOCATABLE.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 4
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

					;PAGE 4
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 5
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

					;PAGE 5

					;GRI-909 ASSEMBLER, PART C, PAGE 5

					;SYMBOL TABLE ROUTINES.
					;SINSRT-- INSERT SYMBOL. CALLED BY
					;	MOVE ARG,SYMBLK ;SYMBOL ARCHETYPE BLOCK IS ARGUMENT.
					;	PUSHJ P,SINSRT

					;LOOKUP-- LOOK UP SYMBOL, CALLED BY
					;	MOVE ARG,SYMBOL
					;	PUSHJ P,LOOKUP	;LOOK UP SYMBOL
					;	...	;NOT FOUND
					;	...	;FOUND, ARG POINTS AT SYMBOL BLOCK.
					;BOTH LOOKUP AND SINSRT HAVE BEEN MOVED TO AN EXTERNAL MODULE.

						EXTERN SINSRT,LOOKUP
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

					;PAGE 6

					;GRI-909 ASSEMBLER, PART C, PAGE 6

					;GTCHRS-- GET CHARACTER SUBROUTINE.  THIS ROUTINE DOES INTERNAL
					;LINE BUFFERING SO THAT WE CAN PROCESS THE UNUSUAL GRI-909

	402365'	332 14 0 00 000156'	GTCHRS:	SKIPE T,BUFPTR		;IS THE BUFFER POINTER ZERO?
	402366'	336 04 0 14 000000	FCHR:	SKIPN CHR,(T)		;NO, IS THE CHARACTER OBTAINED ZERO?
	402367'	254 00 0 00 402374'		JRST NEWLIN		;YES, GET A NEW LINE.
	402370'	202 04 0 00 000150'		MOVEM CHR,CHAR	;NO, SAVE CHARACTER.
	402371'	350 00 0 00 000156'		AOS ,BUFPTR	;INCREMENT POINTER AND EXIT.
	402372'	263 17 0 00 000000		POPJ P,

	402373'	367 05 0 00 402376'	RUBOUT:	SOJG AC,NXTCHR		;RUBOUT FUNCTION (): IF LINE ALREADY EMPTY.
									;GET A NEW CHARACTER.
	402374'	634 05 0 00 000005	NEWLIN:	TDZA AC,AC	;CLEAR PTR INTO LINE BUFFER AND SKIP.
	402375'	661 01 0 00 100000	SETFFF:	TLO AF,QFF	;FORM FEED... SET FLAG AND IGNORE.
	402376'	260 17 0 00 000000*	NXTCHR:	PUSHJ P,$RDCHR		;GET A CHARACTER.
	402377'	254 00 0 00 402425'		JRST NOINPT		;NONE PRESENT, SET "END" FLAG.
	402400'	306 13 0 00 000012		CAIN ARG,LNFEED	;IS CHARACTER LINE FEED?
	402401'	254 00 0 00 402376'		JRST NXTCHR	;YES, IGNORE IT.
	402402'	306 13 0 00 000014		CAIN ARG,FFEED	;IS CHARACTER FORM FEED?
	402403'	254 00 0 00 402375'		JRST SETFFF	;YES, GO SET FLAG AND IGNORE IT.
	402404'	306 13 0 00 000177		CAIN ARG,177	;IS CHARACTER RUBOUT?
	402405'	254 00 0 00 402374'		JRST NEWLIN	;YES, KILL CURRENT LINE.
	402406'	302 13 0 00 000033		CAIE ARG,033	;IS THE CHARACTER ANY VARIETY OF ALTMODE?
	402407'	306 13 0 00 000175		CAIN ARG,175
	402410'	254 00 0 00 402376'		JRST NXTCHR	;YES, IGNORE IT.
	402411'	305 05 0 00 000160		CAIGE AC,LINMAX
	402412'	202 13 0 05 000157'		MOVEM ARG,LINBUF(AC)	;NEITHER, SAVE CHAR IN LINE BUFFER.
	402413'	302 13 0 00 000015		CAIE ARG,CRTN	;END OF LINE (CARRIAGE RETURN)?
	402414'	344 05 0 00 402376'		AOJA AC,NXTCHR		;NO, GO TO NEXT CHARACTER.
	402415'	202 13 0 05 000157'		MOVEM ARG,LINBUF(AC)	
	402416'	201 13 0 00 000012		MOVEI ARG,LNFEED	;INSERT LINE FEED AFTER CARRIAGE
	402417'	202 13 0 05 000160'		MOVEM ARG,LINBUF+1(AC)	;RETURN ON ACCOUNT OF SOS.
	402420'	402 00 0 05 000161'		SETZM ,LINBUF+2(AC)	;ZERO NEXT CHARACTER.
	402421'	350 00 0 00 402171*		AOS ,$CRFNO	;INCREMENT LINE NUMBER, SINCE WE ARE
								;NOT USING STANDARD $RDLIN ROUTINE.
	402422'	201 14 0 00 000157'		MOVEI T,LINBUF	;RESET BUFFER POINTER
	402423'	202 14 0 00 000156'		MOVEM T,BUFPTR		;TO START OF BUFFER
	402424'	254 00 0 00 402366'		JRST FCHR		;AND GO GET A CHARACTER.

	402425'	661 01 0 00 400000	NOINPT:	TLO AF,QEND		;NO INPUT FOUND... SET END FLAG.
	402426'	403 04 0 00 000150'		SETZB CHR,CHAR		;RETURN ZERO AS OUTPUT
	402427'	603 00 0 00 400000		TLNE F,QPASS1		;IF PASS1, OUTPUT NASTY MESSAGE.
	402430'	051 03 0 00 402432'		OUTSTR NOENDM
	402431'	263 17 0 00 000000		POPJ P,

	402432'	077 116 117 040 105	NOENDM:	ASCIZ /?NO END STATEMENT FOUND
	402433'	116 104 040 123 124
	402434'	101 124 105 115 105
	402435'	116 124 040 106 117
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 6-1
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

	402436'	125 116 104 015 012	/
	402437'	000 000 000 000 000


GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7
GRE	MAC	 7-NOV-72 17:48		INPUT, OUTPUT, AND SUPPORT ROUTINES

					;PAGE 7

					;GRI-909 ASSEMBLER, PART C, PAGE 7

					;VARIABLES AND DATA STRUCTURES.
						SUBTTL VARIABLES AND DATA STRUCTURES
						INTERN $DFSRC,$DFBIN,$USRSW,$NAME,$VRSN,$TITLE,IPCODE
	402440'	47 62 51 00 00 00	$DFSRC:	SIXBIT /GRI/
	402441'	47 62 54 00 00 00	$DFBIN:	SIXBIT /GRL/
					IFN GRI99,<
					$NAME:	ASCIZ /GRI-99 MIMIC ASSEMBLER/
					IPCODE:	^D314
					>
					IFE GRI919+GRI99,<
	402442'	107 122 111 055 071	$NAME:	ASCIZ /GRI-909 MIMIC ASSEMBLER/
	402443'	060 071 040 115 111
	402444'	115 111 103 040 101
	402445'	123 123 105 115 102
	402446'	114 105 122 000 000
	402447'	000000	000471		IPCODE:	^D313
					>
					IFN GRI919,<
					$NAME:	ASCIZ /GRI-919 MIMIC ASSEMBLER/
					IPCODE:	^D320
					>

						DEFINE SW(A,B)
					<	ASCIZ /A/
						B>

	402450'	111 116 106 000 000	$USRSW:	SW INF,<TRZ F,QNOINF>	;/INF = ALLOW INSTRUCTION FORM
	402451'	620 00 0 00 000004
	402452'	055 111 116 106 000		SW -INF,<TRO F,QNOINF>	;/-INF = SUPPRESS INSTRUCTION FORM
	402453'	660 00 0 00 000004
	402454'	000 00 0 00 000000		Z
	402455'	06 04 0 00 000154'	MODPTR:	POINT 4,WORD1,29
	402456'	12 06 0 00 000154'	SRCPTR:	POINT 6,WORD1,25
	402457'	00 06 0 00 000154'	DSTPTR:	POINT 6,WORD1,35
	402460'	10 02 0 00 000154'	PMDPTR:	POINT 2,WORD1,27
	402461'	00 10 0 00 000154'	RHBYTE:	POINT 8,WORD1,35
	402462'	10 10 0 00 000154'	LHBYTE:	POINT 8,WORD1,27
	402463'	07 03 0 00 000154'	CNDPTR:	POINT 3,WORD1,28
	402464'					LIT
	402464'	000150'	000151'
	402465'	44 07 0 00 000357'
	402466'	44 07 0 00 000411'
	402467'	000000	000012
	402470'	44 06 0 00 000007
	402471'	777777	600000
	402472'	73 51 56 44 70 75
	000000'					RELOC 0
	000000'				UDFBLK:	BLOCK 1	;UNDEFINED SYMBOL ARCHETYPE
	000001'	000000	177777			177777	;VALUE IS INITIALLY ABSOLUTE -1.
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 7-1
GRE	MAC	 7-NOV-72 17:48		VARIABLES AND DATA STRUCTURES

	000002'	000200	000000			XWD QUNV,0
	000003'					BLOCK 1	;NO CREF LINKS

	000004'				PUNPSN:	BLOCK 1	;BUFFER POSITION POINTER.
	000005'				PNBFST:	BLOCK 1	;PUNCH BUFFER HEADER
	000006'				PUNSUM:	BLOCK 1	;CHECKSUM
	000007'				PUNCNT:	BLOCK 1	;ITEM COUNT
	000010'				PUNBUF:	BLOCK ^D96	;BUFFER SHOULD BE MULTIPLE OF 6 WORDS
			000140			PUNMAX=.-PUNBUF

	000150'				TGR:	;CLEARED CORE AREA.
	000150'				CHAR:	BLOCK 1
	000151'				TRMCR:	BLOCK 1
	000152'				OLDLOC:	BLOCK 1
	000153'				CURLOC:	BLOCK 1
	000154'				WORD1:	BLOCK 1
	000155'				WORD2:	BLOCK 1
	000156'				BUFPTR:	BLOCK 1

	000157'				LINBUF:	BLOCK ^D120
			000160			LINMAX=.-LINBUF-10

	000347'				TGREND:	BLOCK 1
	000350'				LEXLST:	BLOCK 1	;LOCAL EXTERN LIST HEADER
	000351'				LEXPTR:	BLOCK 1	;LOCAL EXTERN LIST POINTER
	000352'				MEXLST:	BLOCK 1	;MASTER EXTERN LIST HEADER
	000353'				MEXPTR:	BLOCK 1	;MASTER EXTERN LIST POINTER
	000354'				LOCBLK:	BLOCK 1	;ALLOCATED BLOCK LIST
	000355'				SAVNAM:	BLOCK 1	;TEMPORARY (VERY).
	000356'				PRADIX:	BLOCK 1
	000357'				$TITLE:	BLOCK ^D26
	000411'				$SUBTT:	BLOCK ^D26
						END

NO ERRORS DETECTED

HI-SEG. BREAK IS 402473
PROGRAM BREAK IS 000443

3K CORE USED
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8
GRE	MAC	 7-NOV-72 17:48		SYMBOL TABLE

ABS	260740	401374'		CLOOPR		402307'		GETNUM	260740	401327'		MSKNUM		401355'	
ABSLOC		401140'		CLP		400664'		GOTIT		401710'		MULSUB		401542'	
ABSLP		401373'		CLSS10		401024'		GRI919		000000		NAME		000007	
ABSORB		401374'		CLSS11		401036'		GRI99		000000		NBITS		402340'	EXT
AC		000005		CLSS12		401055'		GRIENT		100000		NEWLIN		402374'	
AC1		000006		CLSSTB		400645'		GRIMIN		010000		NMEXIT		401350'	
AC2		000010		CMPASS		400007'		GRIPLS		020000		NOCREF		402173'	
AC3		000011		CNDPTR		402463'		GRIREL		040000		NODATA		402213'	
AC4		000012		COMMA		000002		GTCHRS		402365'		NOENDM		402432'	
ADDONE		400674'		CPOPJ		402310'		GTNAMS		401304'		NOINPT		402425'	
ADOP		401466'		CPOPJ1		401573'		GTNUMS		401327'		NOINS		402240'	
ADR		000000	SPD	CREF		401622'	EXT	ILLOC		401200'		NOLINE		402261'	
ADVOP		401477'		CREXP		401607'		INCRXT		402052'		NOLOCN		402203'	
ADVOPR		401455'		CRLBL		400557'		INDBBF		402153'		NOPNCH		402051'	
AF		000001		CRTN		000015		INDBNT		402154'		NOPUN		402017'	
ALLERR		007777		CURLOC		000153'		INDCBF		402145'		NORELN		401431'	
ALLOC		401706'	EXT	DCREF		401220'	EXT	INDCNT		402147'		NOSEQN		402254'	
ALLUSR		000007		DIGITL		000000	SPD	INDXBL		402034'		NOTABS		402244'	
ALPHA		402065'		DIVSUB		401550'		INITNX		401765'	EXT	NOTDFN		400553'	
ARG		000013		DOTAIL		401357'		INITSL		400045'		NOTEQD		400605'	
ASCLP		401257'		DSTPTR		402457'		INITSM		400035'		NOTEQV		400603'	
BADASC		401366'		DTALIN		000000	SPD	INITST		400003'	EXT	NOTFND		400551'	
BFCNVT	265700	402072'		ENDDC		401753'		INSFM		402242'		NRADIX		402341'	EXT
BFINIT	265700	402147'		ENTDCL		401740'		INSPT2		402030'		NRELOP		000002	
BFINST	265700	402101'		ENTERR		401201'		IPCODE		402447'	INT	NTDFOP		400716'	
BLKOP		401441'		ENTFLG		401756'		ISC		000000	SPD	NTFND		401612'	
BLNKOP		401474'		ENTLP		401157'		LBLRTN		400514'		NUM		000007	
BUFCVT		402072'		EOASMB		400033'	EXT	LEADER		402342'	EXT	NUMLP		401330'	
BUFINS		402101'		ERCNT		000014		LEXLST		000350'		NUMOP		000005	
BUFPTR		000156'		ERRCHR		402311'		LEXPTR		000351'		NXTCHR		402376'	
C10A		401032'		EVALXP		401404'		LHBYTE		402462'		NXTFAC		401416'	
C11A		401053'		EVLABS		401401'		LINBUF		000157'		NXTFC1		401415'	
C7A		400776'		EVLIN1		400620'		LINK		000001		NXTSYM		401766'	EXT
CCOMMA		400662'		EVLREL		401402'		LINMAX		000160		OLDLOC		000152'	
CDONE		400675'		EXPVAL		000003		LNFEED		000012		ONLINE		000000	SPD
CHAR		000150'		EXTDCL		401766'		LOCBLK		000354'		OPR		000011	
CHKIDX		401666'		EXTERR		401003'		LOCTBL		401135'		OPRTBL		401503'	
CHKIT		401307'		EXTNLP		401207'		LOOKUP		401675'	EXT	OPTBL		400275'	
CHKTWO		402262'		EXTNXP		401661'		MAKBLK		401703'		OPTEND		400511'	
CHR		000004		F		000000		MAKIDX		401726'		ORNUM		000002	
CHRTB		402362'		FACTOR		401556'		MAKUND		401522'		OSCH1		400622'	
CLASS1		400721'		FAIL	254000	000000		MAXCLS		000015		OSCH2		400626'	
CLASS2		400737'		FCHR		402366'		MEQVVR		400601'		OTPCMN		402114'	
CLASS3		400732'		FDATA		000000	SPD	MERROR		400547'		OTPDAT		402113'	
CLASS4		400743'		FFEED		000014		MEXLST		000352'		OTPDCN		402110'	
CLASS5		400755'		FLGS		000002	SPD	MEXPTR		000353'		OUTPUT		402160'	
CLASS6		400762'		FLSHBU		401367'		MODPTR		402455'		OUTSTR	051140	000000	
CLASS7		400767'		FLTB		401724'		MORFAC		401412'		P		000017	
CLASS8		401005'		FND		401572'						PARITH		401777'	
CLASS9		401017'		FOUNDO		400634'						PASC		401253'	
CLNUP		401636'		GETCHR	260740	402365'						PASS1X		402325'	
				GETNAM	260740	401304'						PDECIM		401120'	
												PDICTN		402007'	
GRIRAS	GRI-909/99/919 RELOCATING ASSEMBLER	MACRO 47(113) 16:10  8-MAR-73 PAGE 8-1
GRE	MAC	 7-NOV-72 17:48		SYMBOL TABLE

PEJECT		401075'		PUTRH		401300'		QSERR		000400		SYMV		000001	
PEND		401124'		PWRD		401242'		QSIMPL		020000		T		000014	
PENTDC		401733'		QADVF		000100		QSYML		000040		T1		000015	
PENTRY		401160'		QANLST		002000		QSYMOF		100000		T2		000016	
PEQUIV		400562'		QBINOF		004000		QTFERR		000040		TGR		000150'	
PERIOD		401575'		QCCL		000010		QTMERR		000020		TGREND		000347'	
PERROR		400546'		QCCLC		000004		QTTY		000200		TIMLTD		000000	SPD
PEXTDC		401761'		QCCLU		000100		QTWO		040000		TOOFEW		401002'	
PEXTRN		401203'		QCREF		001000		QUERR		000100		TOOFW2		401000'	
PJRST	254000	000000		QDERR		001000		QUNV		000200		TOOFWX		401001'	
PLABEL		400532'		QDIR		200000		QUOTE		401627'		TRMCR		000151'	
PLIST		401072'		QEERR		000010		QVAL		200000		TRMSUB		401513'	
PLOC		401127'		QEMPTY		010000		QVERFY		002000		TYMSHR		000000	SPD
PMDPTR		402460'		QEND		400000		QXERR		000200		UDFBLK		000000'	
PNBFST		000005'		QENT		020000		QXPAND		004000		UNDFD		401614'	
PNLIST		401067'		QEOF		000002		QXTERR		000004		UNDFOP		400677'	
POCTAL		401121'		QEQV		002000		QXTNFR		000400		VALUE		402343'	EXT
PPKB		401230'		QERROR		000001		QXTNON		002000		WORD1		000154'	
PRADIX		000356'		QEXT		040000		R50MUL		402066'		WORD2		000155'	
PRBIN4		402345'		QFF		100000		RAD50C	265700	402054'		WRCRLF		402261'	EXT
PRCREF		402350'		QICRF		000020		RAD50L		402055'		WRTFLG		402310'	INT
PREL		401152'		QINDEX		040000		RAD50S		402054'		WRTINT		402344'	EXT
PRERRS		402277'		QINF		100000		REDEFN		400607'		WRTNOL		000000	EXT
PRLINE		402246'		QINS		400000		RELBAS		000001		$CRFNO		402421'	EXT
PROCES		400512'		QLBL		000100		RELBYT		402105'		$DFBIN		402441'	INT
PROCLN		400527'		QLIN		020000		RELLOC		401144'		$DFSRC		402440'	INT
PROCT2		402333'		QLIT		100000		RELOK		401651'		$ERCNT		402306'	EXT
PROCT6		402335'		QLOC		400000		REPRIM		401302'		$NAME		402442'	INT
PROCTL		402336'		QLSTOF		010000		RHBYTE		402461'		$PASS1		400001'	ENT
PROCTR		402354'		QMAC		000001		ROTERR		402301'		$PASS2		400006'	ENT
PRSTD		402337'		QMACOF		040000		RUBOUT		402373'		$RDCHR		402376'	EXT
PRSTO		402340'		QMERR		002000		SAVNAM		000355'		$SQNUM		402250'	EXT
PRSYMB		402354'	INT	QNADV		000200		SETFFF		402375'		$SUBTT		000411'	INT
PSBTTL		401100'		QNBINR		020000		SETRLX		401647'		$TITLE		000357'	INT
PSYMTB		400054'		QNERR		000001		SETSR		401571'		$USRSW		402450'	INT
PTITLE		401077'		QNLSTR		040000		SETUFL		401615'		$VRSN		400000'	INT
PUNBUF		000010'		QNMACR		010000		SHFSUB		401535'		$WRCHR		402360'	EXT
PUNCH		402040'		QNOBIN		200000		SIMPLX		401674'		$WRLIN		402251'	EXT
PUNCMN		402123'		QNOERR		000040		SINSRT		401524'	EXT	$WRWRD		402142'	EXT
PUNCNT		000007'		QNOINF		000004		SPCL		402063'		
PUNDON		402140'		QNOLST		100000		SRCPTR		402456'		
PUNLDR		402140'		QNOMAC		200000		STL		401111'		
PUNLP2		402122'		QNOSMT		000020		STONUM		401334'		
PUNMAX		000140		QNOSYM		400000		STOPT		400711'		
PUNPSN		000004'		QNQUES		000400		STORIT		401317'		
PUNSUM		000006'		QNSYMR		020000		STORWD		400613'		
PUTASC		401271'		QNYDAT		001000		SUBSUB		401527'		
PUTLH		401274'		QOVRID		001000		SYMBOL		401600'		
				QPASS1		400000		SYMC		000003		
				QPERR		004000		SYMF		000002		
				QPUN		010000		SYMLNT		000004		
				QRELON		004000		SYMN		000000		
    2x
8