	SALL
;COPYRIGHT 1973, APPLIED DATA RESEARCH, PRINCETON, N.J.
;
	TITLE CPUDDM	GRI-909 CPU DESCRIPTOR
	MEMSIZ=CPU*^D1024
	ENTRY CPUDDM
	INTERN ITIM,GRIXR,THUMB,DSPLY
	INTERN RTCTIM,IRSAVE
	EXTERN .FLAGS,CPURD,CPUWR,CPURST,CPUADR
	EXTERN SUMTBL,SLPCHK,BRSET,BLDUP,TRDOWN,GFETCH,LOADER
	INTERN TRAPS,CPUUCB,OLDSC,SWR,TRP,STM,ISR
	INTERN AX,AY,AOX,GPR,BSWR,BPKR
	INTERN C,CORE,SYSLST,LDRUCB,MSRMSK

	MMASK=140000
IFN AO,<	MMASK=MMASK+001400>
;
CPUDDM:	DDM1 CPU,CPURDB,CPUUCB
	DDM2 ^D8,^D16,^D8,^D16
	DDM3 QADR+QFIX+QBRK,^D16,MEMSIZ
	DDM4 CPURD,CPUWR,CPURST,CPUADR,BRSET,SLPCHK
;
CPUUCB:	UCB CPU,0,CPUDDM,0,0,QADR+QFIX+QBRK
;
MSRMSK:	MMASK	;MSR MASK
AX:	Z	;ARITHMETIC OPERATOR REGISTERS
AY:	Z
AOX:	Z
GPR:	REPEAT NUMGR,<	Z>	;GENERAL REGISTERS.
BPKR:	Z	;BYTE PACKER REGISTER
BSWR:	Z	;BYTE SWAP REGISTER
TRP:	Z	;TRAP REGISTER
ISR:	Z	;INTERRUPT STATUS REGISTER
SWR:	Z	;SWITCH REGISTER
TRAPS:	300000,,0	;TRAPS
OLDSC:	Z	;OLD SC
IRSAVE:	Z	;SAVED IR
THUMB:	27	;THUMB-WHEELS
DSPLY:	Z	;DISPLAY OUTPUT
GRIXR:	Z	;GRI-99 INDEX REGISTER.
PSCORE:	MEMSIZ
ITIM:	Z	;INTERVAL TIMER
	Z	;LAST TRDN
STM:	Z	;SAVED TIMER
	Z	;SAVED PI REQUESTS
	REPEAT 11,<	Z>	;OTHER SAVED REGISTERS.
	CORE=CPUDDM+DNFRM
;
;
SYSLST:	SIXBIT /GRI/
	Z ,GFETCH
	Z ,CPURDB
	XWD LOADER,LDRUCB
	Z ,BLDUP
	Z ,TRDOWN
	DDM3 QADR+QATBL+QRD,^D36,0
	Z ,STM
;
LDRUCB:	UCB LDR,0,SYSLST,0,0,QADR+QATBL+QRD

RTCTIM:	^D9470	;CLOCK FREQUENCY.
;
;GRI-909 CPUDDM, PAGE 2
;
CPURDB:	RDB SC,STM+SC,16	;REGISTERS:  SC
	RDB STAT,STM+F,16	;DONE FLAGS
	RDB ISR,ISR,16	;ISR
	RDB MSR,MSR+STM,16	;MSR
	RDB TRP,TRP,16	;TRP
IFN AO,<	RDB AX,AX,16	;ARITHMETIC OPTIONS:  AX
	RDB AY,AY,16	;AY
	RDB AO,AOX,16	;AO
>
IFN BSW,<	RDB BSW,BSWR,16	;BYTE SWAPPER
	>
IFN BPK,<	RDB BPK,BPKR,16	;BYTE PACKER
	>
IFN GR,<	RDB GR1,GPR+0,16	;GENERAL REGISTERS:  GR1-GR6
	RDB GR2,GPR+1,16
	RDB GR3,GPR+2,16
	RDB GR4,GPR+3,16
	RDB GR5,GPR+4,16
	RDB GR6,GPR+5,16
>
IFN M99,<	RDB XR,GRIXR,16>	;MODEL 99 INDEX REGISTER.
	RDB SWR,SWR,16	;SWITCHES
	RDB THUMB,THUMB,6	;THUMB WHEELS
	RDB DISP,DSPLY,16	;DISPLAY OUTPUT
	RDB OLDSC,OLDSC,16,P	;OLD SC
	RDB BR,STM+BR,16,P	;BUS REGISTER
	FLG ION,STM+F,0	;?ION
	FLG BOV,STM+MSR,20	;MSR BITS:  BOV
	FLG L,STM+MSR,21	;LINK
	FLG LINK,STM+MSR,21	;LINK
	FLG PWR,STM+F,17	;POWER FAILURE
IFN AO,<	RBLK AOP,STM+MSR,2,,4,27	;ARITHMETIC OPTION
	FLG SOV,STM+MSR,34	;ARITH OVFLO AND SUM OVFLO ARE
	FLG AOV,STM+MSR,35	;MODIFICATIONS TO MSR
	>
	DRDB TM,STM+TM,36,P	;TIMER
	DRDB ITM,ITIM,36	;INTERVAL TIMER
	RDB MA,MA+STM,16,P	;MA
	RDB MB,MB+STM,16,P	;MB
	RDB IR,IRSAVE,16	;INSTRUCTION REGISTER.
	RBLK S,IRSAVE,6,,8,25
	RBLK D,IRSAVE,6,,8,35	;SRC AND DST IN IR
	FLG SINGLE,.FLAGS,1	;SIN INST TRAP
	FLG SI,.FLAGS,1	;SIN INST TRAP (ABBREV)
	FLG MEM,TRAPS,1	;ILL MEM REF TRAP
	FLG UNDFOP,TRAPS,0	;UNDEFINED OPER TRAP

	DEFINE LVRDB(N)
<	IRP N,<
	RBLK PR'N,SUMTBL+^D15-N,FLTMSK,1,8,FLTMSK-1
>>

	LVRDB<0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15>

	DRDB CORE,PSCORE,16,P	;CORE SIZE
	Z	;END
;
C:	XLIST	;CORE ARRAY IS UNLISTED
IF1,<	BLOCK MEMSIZ>
IF2,<	REPEAT MEMSIZ,<0>>
	LIST
	END
