	TITLE CPUDDM	CPU DESCRIPTOR, MIMIC8 SYSTEM.
	ENTRY CPUDDM
;
IFNDEF EAE,<	EAE=0>
IFNDEF PWR,<	PWR=0>
IFNDEF CPU,<	CPU=4>
	MEMSIZ=CPU*^D1024
;
;MIMIC8 SYSTEM, PDP-8/I SIMULATOR, CPU DDM
;
	EXTERN SLPCHK,ADDRNT,CPURD,CPUWR,CPURST,NULL
	EXTERN .FLAGS,.BRSET,.READ,.WRITE
	EXTERN .LOADR,.BLDUP,.TRDN,.FETCH
	INTERN ITIM,SPC,LDRUCB,SYSLST
	INTERN DBR,IBR,IBBR,SR,BSR,OLDPC,PCSAVE,SC
	INTERN STM,CPUUCB,SIO,SLAC,CORE
	INTERN BANK0,BNKTBL,TRAPS
;
;DDM HEADER....
;
CPUDDM:	DDM1 CPU,CPURDB,CPUUCB	;DEVICE HEADER.
	DDM2 ^D8,^D15,^D8,^D12	;ADDRESSES AND FRAMES
	DDM3 QADR+QFIX+QBRK,^D12,MEMSIZ
	DDM4 CPURD,CPUWR,CPURST,ADDRNT,.BRSET,SLPCHK

	CORE=CPUDDM+DNFRM
;
CPUUCB:	UCB CPU,0,CPUDDM,NULL,0,QADR+QFIX+QBRK
;
BNKTBL:	BANK0(MA)	;FETCH/STORE FROM MEMORY TABLE.
	BANK1(MA)
	BANK2(MA)
	BANK3(MA)
	BANK4(MA)
	BANK5(MA)
	BANK6(MA)
	BANK7(MA)
;
;CPUDDM, PAGE 2
;
;SCRATCH STORAGE.  1) SAVE AREA FOR ACTIVE REGISTERS.
;2) OTHER REGISTERS.  3) CORE STORAGE.
;
ITIM:	Z	;INTERVAL TIMER
	Z	;LAST UPDATE OF ITIM.
XXCORE:	MEMSIZ	;CORE REGISTER
STM:	Z	;SAVE TIMER
SIO:	Z	;SAVED FLAGS
SIR:	Z	;IR AND OTHER SAVED REGISTERS
SPC:	Z	;PC
SLAC:	Z	;L-AC
SMQ:	Z	;MQ
SMA:	Z	;MA
SMB:	Z	;MB
	Z	;SAVED XRS
	Z
	Z
;
IBR:	Z	;IBR AND OTHER REAL REGISTERS
DBR:	Z
IBBR:	Z
BSR:	Z
SR:	Z
OLDPC:	Z
SC:	Z
PCSAVE:	Z
TRAPS:	Z	;ILLEGAL CONDITION TRAP FLAGS
;
;
;REGISTER DESCRIPTION BLOCKS
;
CPURDB:	RDB AC,SLAC,12	;AC,SAVED.
IFN EAE,<	RDB MQ,SMQ,12>	;MQ, SAVED.
	RDB MA,SMA,12,P
	RDB MB,SMB,12,P
	RDB IR,SIR,3,P
CPUPC:	RDB PC,SPC,15
	RDB SR,SR,12
	RDB IBBR,IBBR,3
	RDB DBR,DBR,3
	RDB OLDPC,OLDPC,15,P
	RDB BSR,BSR,6
	DRDB TM,STM,36,P
	DRDB ITM,ITIM,36	;INTERVAL TIMER
	RDB STAT,SIO,12
IFN EAE,<	RDB SC,SC,5>	;SHIFT COUNTER.
;
	FLG L,SLAC,^D23
	FLG LINK,SLAC,^D23
	FLG ION,SIO,1
IFN PWR,<	FLG PWR,SIO,27>
	FLG SINGLE,.FLAGS,1
	FLG SI,.FLAGS,1	;SINGLE INST TRAP, REGULAR AND ABBREV
	FLG ILLEG,TRAPS,0
	DRDB CORE,XXCORE,15,P
;
	RBLK IBR,SPC,3,,8,23
	Z
;
BANK0:	;MEMORY ARRAY, UNLISTED.
	XLIST
	REPEAT MEMSIZ,<	Z>
	LIST
BANK1=BANK0
IFG MEMSIZ-^D4096,<	BANK1=BANK0+^D4096>
BANK2=BANK0
IFG MEMSIZ-^D8192,<	BANK2=BANK0+^D8192>
BANK3=BANK1
IFG MEMSIZ-^D12288,<	BANK3=BANK0+^D12288>
BANK4=BANK0
IFG MEMSIZ-^D16384,<	BANK4=BANK0+^D16384>
BANK5=BANK1
IFG MEMSIZ-^D20480,<	BANK5=BANK0+^D20480>
BANK6=BANK2
IFG MEMSIZ-^D24576,<	BANK6=BANK0+^D24576>
BANK7=BANK3
IFG MEMSIZ-^D28672,<	BANK7=BANK0+^D28672>
;
;
;CPUDDM, PAGE 3
;
SYSLST:	SIXBIT /PDP8/	;SYSTEM LIST:  SYSTEM NAME
	Z ,.FETCH	;ENTRY TO FETCH PHASE
	Z ,CPUPC	;PC RDB
	XWD .LOADR,LDRUCB	;SYSTEM LOADER INFORMATION.
	Z ,.BLDUP	;BUILD UP VM AC'S
	Z ,.TRDN	;TEAR DOWN VM AC'S.
	DDM3 QADR+QATBL+QRD,^D36,0
	Z ,STM	;SYSTEM TIMER
;
LDRUCB:	UCB LDR,0,SYSLST,NULL,LDRFAB,QADR+QATBL+QRD
;
LDRFAB:	FAB LDR,0
	END
