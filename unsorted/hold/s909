	XALL
	XLIST
;
;GRI-909 SIMULATOR DEFINITIONS.
;R.M. SUPNIK, 4/9/71
;
;DEFAULT DEFINITION MACROS:

IFNDEF VM,<	VM=SIXBIT/GRI909/>
IFE <VM-SIXBIT/GRI99/>,<	M99=1>

DEFINE OPT(NM,AA)	;OPTION DEFN
<IFNDEF NM,<	NM=0>
IFNDEF NM'A,<	NM'A=AA>>

DEFINE DEV(NM,AA,BB,CC)	;DEVICE DEFNS
<IFNDEF NM,<	NM=0>
IFNDEF NM'A,<	NM'A=AA>
IFNDEF NM'I,<	NM'I=BB>
IFNDEF NM'B,<	NM'B=^D'CC>>

	TTI=1
	LSR=1
	TTO=1
	OPT AO,11	;ARITHMETIC OPERATOR
	OPT GR,30	;GENERAL REGISTERS
	OPT BSW,24	;BYTE SWAPPER
	OPT BPK,25	;BYTE PACKER
	OPT DAC,61	;DIGITAL TO ANALOG CONVERTER
	OPT MUX,64	;ADC MULTIPLEXOR
IFE AO&GR,<	EAO=0>	;ALLOW EAO ONLY IF BOTH GR AND AO PRESENT.
	OPT EAO,14	;EXTENDED ARITHMETIC OPERATOR
	OPT M99,22	;MODEL 99 HAS TWO EXTRA OPERATORS
			;22=INDEX REGISTER
			;23=ALTERNATE TRAP

	DEV HSR,76,22,3	;HIGH SPEED READER
	DEV HSP,76,17,2	;HIGH SPEED PUNCH
	DEV TTI,77,14,1	;KEYBOARD
	DEV TTO,77,11,0	;TELEPRINTER
	DEV RTC,75,100,11	;CLOCK
	DEV DSK,66,41,6	;DISK
	DEV ADC,65,52,12	;ANALOG TO DIGITAL CONVERTER
	PTR=HSR	;OLD NAMES
	PTP=HSP

IFNDEF CPU,<	CPU=4>	;CENTRAL MEMORY

	BOV=100000	;BITS IN MACHINE STATUS REG:  BUS OVFLO
	LINK=040000	;LINK
	SOV=000002	;SUM (SIGN) OVERFLOW
	AOV=000001	;ARITHMETIC OPERATOR OVERFLOW

	PWRF=1	;POWER FAILURE (LEFT HALF)
	ADCBIT=10000	;ADC
	CBIT=4000	;CLK
	RBIT=10	;DEVICE BITS MASKS IN ISR
	PBIT=4	;READER AND PUNCH
	KBIT=2	;KEYBOARD AND PRINTER
	TBIT=1
	DBIT=100	;DISK
;
;AC ASSIGNMENTS.
;
	TM=0	;TIMER (IN MAJOR CYCLES)
	F=1	;DONE FLAGS
	MA=2	;MEMORY ADDRESS
	SC=3	;SEQUENCE COUNTER
	BR=4	;BUS BUFFER REGISTER
	IR=5	;INSTRUCTION REGISTER
	D=6	;DESTINATION OPERATOR
	MSR=7	;MACHINE STATUS REGISTER
	S=10	;SOURCE OPERATOR
	MB=11	;MEMORY BUFFER
	XR=12	;INDEX REGISTER
	R=14	;LINK REGISTER
	TMP=15	;TEMPORARIES
	TMP1=16
	TMP2=13
	P=17	;PUSHDOWN POINTER.

	DEFINE ACTIVE(NM,L)
<	SKIPE ,NM'UCB+UACT
	JRST L
	MOVE TMP,TM
	ADD TMP,NM'TIM
	MOVEM TMP,NM'UCB+UTIM
	MOVEI TMP,NM'UCB
	MOVEM TMP,.UCBAD
	PUSHJ P,.ACTVT>

	DEFINE CANCEL(NM)
<	SKIPN ,NM'UCB+UACT
	POPJ P,
	MOVEI TMP,NM'UCB
	MOVEM TMP,.UCBAD
	PUSHJ P,.CNCEL
	POPJ P,>

	NUMGR=6	;# OF GENERAL REGISTERS.
	INTSIZ=^D19	;SIZE OF INTERRUPT TABLE
	EXTERN SMGR
	LIST
