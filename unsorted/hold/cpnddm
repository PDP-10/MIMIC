	TITLE CPUDDM	NOVA/SUPERNOVA CPU DESCRIPTOR MODULE
;
	IFNDEF CORE,<	CORE=4>
	MEMSIZ=CORE*^D1024
;
	ENTRY CPUDDM
	INTERN LDRFLG,CPUPC,SYSLST,CPUUCB,C,CARRY,XCORE,CMASK,AC
	INTERN ITIM,LDRUCB,TTITIM,INDMAX
	EXTERN CPURD,CPUWR,CPURST,NULL
	INTERN STM,SBSY,SDON,SR,OLDPC,DSBLE,TRAPS
	EXTERN SLPCHK,BRSET,.FLAGS,ADDNOV
	EXTERN LOADR,.FETCH,.BLDUP,.TRDN
;
CPUDDM:	DDM1 CPU,CPURDB,CPUUCB
	DDM2 ^D8,^D15,^D8,^D16
	DDM3 QADR+QFIX+QBRK,^D16,MEMSIZ
	DDM4 CPURD,CPUWR,CPURST,ADDNOV,BRSET,SLPCHK
;
CPUUCB:	UCB CPU,0,CPUDDM,NULL,0,QADR+QFIX+QBRK
;
AC:	Z	;ACCUMULATORS
	Z
	Z
	Z
SR:	Z	;SWITCH REGISTER
CARRY:	Z	;CARRY BIT
OLDPC:	Z	;OLD PROGRAM COUNTER
DSBLE:	Z	;INTERRUPT DISABLE FLAGS.
TRAPS:	XWD 200000,0	;ILLEGAL CONDITION TRAP WORD.
LDRFLG:	Z	;LOADER FLAG
PSCORE:	MEMSIZ	;CORE REGISTER
INDMAX:	^D10	;INDIRECT ADDR LEVEL MAXIMUM
;
ITIM:	Z	;INTERVAL TIMER
	Z	;TIME OF LAST TRDN
STM:	Z	;SAVED REGISTERS:  TIMER
SBSY:	Z
SDON:	Z
SPC:	Z
SMA:	Z
SMB:	Z
	BLOCK 6

	XCORE=CPUDDM+DNFRM
	CMASK=MEMSIZ-1

TTITIM:	IFN NOVA,<	^D14000>	;TTI TIME VARIES WITH
	IFN NOVA12,<	^D5000>	;THE CPU SELECTED.  FASTER CPU'S
	IFN NOVA8,<	^D3000>	;REQUIRE HIGHER SAMPLING RATES.
	IFN SUPERN,<	^D3000>
	IFN SCNOVA,<	^D2000>
;
;CPUDDM, PAGE 2
;REGISTER DESCRIPTION BLOCKS.
;
CPURDB:	RDB AC0,AC+0,16	;AC'S
	RDB AC1,AC+1,16
	RDB AC2,AC+2,16
	RDB AC3,AC+3,16
CPUPC:	RDB PC,SPC,15	;PC
	RDB MA,SMA,15,P	;MA, WRITELOCKED
	RDB MB,SMB,16,P	;MB, WRITELOCKED
	RDB OLDPC,OLDPC,15,P	;OLD PC, WRITELOCKED
	RDB SR,SR,16	;SWITCHES
	RDB STAT,SDON,18
	FLG SINGLE,.FLAGS,1	;SINGLE INSTRUCTION FLAG
	FLG SI,.FLAGS,1	;SINGLE INSTRUCTION FLAG (ABBREV)
	FLG ILLEG,TRAPS,0	;ILLEGAL INSTRUCTION TRAP FLAG.
	FLG MEM,TRAPS,1	;ILLEGAL MEMORY TRAP FLAG.
	FLG CARRY,CARRY,19	;CARRY
	FLG C,CARRY,19	;CARRY
	FLG ION,SBSY,0	;INTERRUPTS ON/OFF
	DRDB TM,STM,36,P	;SYSTEM TIMER
	DRDB ITM,ITIM,36	;INTERVAL TIMER
	RDB MASK,DSBLE,18	;DISABLE MASK
	DRDB INDMAX,INDMAX,15	;INDIRECT ADDR LEVEL MAXIMUM
	DRDB CORE,PSCORE,15,P	;SYSTEM CORE
	Z
;
C:	XLIST	;UNLIST CORE MEMORY
	REPEAT MEMSIZ,<0>
	LIST
;
;CPUDDM, PAGE 3
;SYSTEM LIST AND LOADER UCB
;
SYSLST:	SIXBIT /NOVA/	;FAMILY NAME
	Z ,.FETCH	;FETCH PHASE
	Z ,CPUPC	;PC RDB
	XWD LOADR,LDRUCB	;LOADER INFO
	Z ,.BLDUP
	Z ,.TRDN
	DDM3 QADR+QATBL+QRD,^D36,0	;PSEUDO-DDM INFORMATION
	Z ,STM	;SYSTEM TIMER
;
LDRUCB:	UCB LDR,0,SYSLST,NULL,0,QADR+QATBL+QRD


	RELOC CPUDDM+DSYN
	EXTERN NOVSYN
	NOVSYN	;LINK INTO NOVA DEVICE SYNTAX.
	END
